// Food Agent Core
class FoodAgent {
    constructor() {
        this.mealRecords = [];
        this.exerciseRecords = [];
        this.conversationHistory = [];
        this.conversationCount = 0;
        this.useAI = false;
        this.aiProvider = 'local';
        this.weeklyPlan = null;
        this.userProfile = {
            goal: 'maintain',
            dailyCalorieTarget: 2000
        };
        if (typeof API_CONFIG !== 'undefined') {
            this.aiProvider = API_CONFIG.provider;
            this.checkAPIConfig();
        }
        this.loadData();
    }
    
    loadData() {
        try {
            const savedMeals = localStorage.getItem('mealRecords');
            const savedExercises = localStorage.getItem('exerciseRecords');
            if (savedMeals) this.mealRecords = JSON.parse(savedMeals);
            if (savedExercises) this.exerciseRecords = JSON.parse(savedExercises);
        } catch (e) {}
    }
    
    saveData() {
        try {
            localStorage.setItem('mealRecords', JSON.stringify(this.mealRecords));
            localStorage.setItem('exerciseRecords', JSON.stringify(this.exerciseRecords));
        } catch (e) {}
    }
    
    checkAPIConfig() {
        if (typeof API_CONFIG === 'undefined') return;
        const config = API_CONFIG[this.aiProvider];
        if (config && config.apiKey && config.apiKey.trim()) {
            this.useAI = true;
        }
    }
    
    async processMessage(msg) {
        this.conversationCount++;
        this.conversationHistory.push({role: 'user', content: msg, timestamp: new Date()});
        let response = this.useAI ? await this.processWithAI(msg) : this.processLocal(msg);
        this.conversationHistory.push({role: 'assistant', content: response.text, timestamp: new Date()});
        return response;
    }
    
    processLocal(msg) {
        const m = msg.toLowerCase();
        if (m.includes('æ¨è')) return this.foodRecommend(msg);
        if (m.includes('èœå“åˆ—è¡¨') || m.includes('èœè°±åˆ—è¡¨') || m.includes('æ‰€æœ‰èœå“') || m.includes('å…¨éƒ¨èœå“')) return this.showAllFoods();
        if (m.includes('æ€ä¹ˆåš') || m.includes('èœè°±')) return this.recipeQuery(msg);
        if (m.includes('è¯¦ç»†') && m.includes('è¥å…»')) return this.detailedNutrition(msg);
        if (m.includes('è¥å…»')) return this.nutritionAnalysis(msg);
        if (m.includes('ä¸€å‘¨') || m.includes('å‘¨è®¡åˆ’') || m.includes('é¥®é£Ÿè®¡åˆ’')) return this.generateWeeklyPlan(msg);
        // æ›´çµæ´»çš„è¿åŠ¨è¯†åˆ«ï¼šæ”¯æŒå¤šç§å£è¯­åŒ–è¡¨è¾¾
        if (this.isExerciseMessage(m)) return this.recordExercise(msg);
        if (m.includes('è®°å½•') || m.includes('åƒäº†')) return this.mealRecord(msg);
        if (m.includes('è®¡ç®—')) return this.calorieCalculator(msg);
        if (m.includes('æŸ¥çœ‹')) return this.viewRecords();
        if (m.includes('å¸®åŠ©')) return this.showHelp();
        return this.chat();
    }
    
    // åˆ¤æ–­æ˜¯å¦æ˜¯è¿åŠ¨è®°å½•æ¶ˆæ¯
    isExerciseMessage(msg) {
        const exercises = ['è·‘æ­¥', 'å¿«èµ°', 'æ•£æ­¥', 'æ¸¸æ³³', 'éª‘è¡Œ', 'è·³ç»³', 'ç‘œä¼½', 'åŠ›é‡è®­ç»ƒ', 'ç¯®çƒ', 'è¶³çƒ', 'ç¾½æ¯›çƒ', 'çˆ¬æ¥¼æ¢¯', 'è·³èˆ', 'å¥èº«æ“', 'æ™®æ‹‰æ', 'å¤ªæ', 'çˆ¬å±±', 'æ‹³å‡»', 'æ»‘å†°', 'ç½‘çƒ', 'ä¹’ä¹“çƒ', 'å¾’æ­¥'];
        const timeWords = ['åˆ†é’Ÿ', 'å°æ—¶', 'åŠå°æ—¶', 'ä¸€å°æ—¶', 'ä¸¤å°æ—¶'];
        
        // æ£€æŸ¥æ˜¯å¦åŒ…å«è¿åŠ¨å…³é”®è¯å’Œæ—¶é•¿å…³é”®è¯
        const hasExercise = exercises.some(e => msg.includes(e));
        const hasTime = timeWords.some(t => msg.includes(t)) || /\d+/.test(msg);
        
        return hasExercise && hasTime;
    }
    
    foodRecommend(msg) {
        const foods = {
            breakfast: [
                {name: 'è±†æµ†æ²¹æ¡', calories: 350}, {name: 'ä¸‰æ˜æ²»', calories: 280}, {name: 'å°ç¬¼åŒ…', calories: 320}, {name: 'ç‡•éº¦ç²¥', calories: 150}, {name: 'ç…é¥¼æœå­', calories: 380},
                {name: 'çš®è›‹ç˜¦è‚‰ç²¥', calories: 220}, {name: 'é¸¡è›‹çŒé¥¼', calories: 340}, {name: 'ç‰›å¥¶éº¦ç‰‡', calories: 180}, {name: 'è‚ ç²‰', calories: 260}, {name: 'åŒ…å­é¦’å¤´', calories: 300},
                {name: 'å…¨éº¦é¢åŒ…', calories: 240}, {name: 'æ°´ç…®è›‹', calories: 80}, {name: 'è±†è…è„‘', calories: 120}, {name: 'çƒ­å¹²é¢', calories: 420}, {name: 'è›‹æŒ', calories: 250},
                {name: 'ç‰ç±³ç²¥', calories: 130}, {name: 'ç”Ÿç…åŒ…', calories: 360}, {name: 'ç‰›è§’åŒ…', calories: 310}, {name: 'å—ç“œç²¥', calories: 140}, {name: 'èŒ¶å¶è›‹', calories: 90},
                {name: 'ç´«è–¯ç²¥', calories: 160}, {name: 'æ‰‹æŠ“é¥¼', calories: 330}, {name: 'é²œå¥¶åå¸', calories: 270}, {name: 'è’¸é¥º', calories: 290}, {name: 'çº¢è±†ç²¥', calories: 170},
                {name: 'åŸ¹æ ¹è›‹', calories: 320}, {name: 'ç³¯ç±³é¸¡', calories: 380}, {name: 'å¸Œè…Šé…¸å¥¶', calories: 150}, {name: 'è™¾é¥º', calories: 200}, {name: 'æ°´æœç‡•éº¦æ¯', calories: 190}
            ],
            // åˆé¤ä¸»é£Ÿï¼ˆä¸»èœç±»ï¼Œé€‚åˆé…ç±³é¥­ï¼‰
            lunchMain: [
                {name: 'å®«ä¿é¸¡ä¸', calories: 450}, {name: 'çº¢çƒ§è‚‰', calories: 550}, {name: 'ç³–é†‹é‡Œè„Š', calories: 480}, {name: 'é±¼é¦™è‚‰ä¸', calories: 420}, 
                {name: 'é’æ¤’è‚‰ä¸', calories: 350}, {name: 'å›é”…è‚‰', calories: 520}, {name: 'æ°´ç…®è‚‰ç‰‡', calories: 480}, {name: 'é…¸èœé±¼', calories: 380},
                {name: 'åœŸè±†ç‚–ç‰›è‚‰', calories: 420}, {name: 'è¥¿çº¢æŸ¿ç‰›è…©', calories: 400}, {name: 'é¦™è‡ç‚–é¸¡', calories: 360}, {name: 'ä¸œå¡è‚‰', calories: 580},
                {name: 'å‰æ¤’é±¼å¤´', calories: 320}, {name: 'å°ç‚’è‚‰', calories: 440}, {name: 'è¾£å­é¸¡', calories: 460}, {name: 'æ¢…èœæ‰£è‚‰', calories: 560},
                {name: 'å’•å’¾è‚‰', calories: 490}, {name: 'ç›ç„—é¸¡', calories: 380}, {name: 'é“æ¿ç‰›æŸ³', calories: 420}
            ],
            // åˆé¤é…èœï¼ˆè”¬èœç±»ã€æ¸…æ·¡ç±»ï¼‰
            lunchSide: [
                {name: 'ç•ªèŒ„ç‚’è›‹', calories: 200}, {name: 'æ¸…è’¸é±¼', calories: 180}, {name: 'éº»å©†è±†è…', calories: 280}, {name: 'çº¢çƒ§èŒ„å­', calories: 240},
                {name: 'è’œè“‰è¥¿å…°èŠ±', calories: 120}, {name: 'æœ¨é¡»è‚‰', calories: 380}, {name: 'å¹²ç…¸è±†è§’', calories: 220}, {name: 'å£æ°´é¸¡', calories: 280},
                {name: 'ç™½ç¼è™¾', calories: 150}, {name: 'èšæ²¹ç”Ÿèœ', calories: 100}, {name: 'å¹²é”…èŠ±èœ', calories: 260}
            ],
            // æ™šé¤ä¸»é£Ÿï¼ˆè›‹ç™½è´¨ä¸ºä¸»ï¼‰
            dinnerMain: [
                {name: 'é¸¡èƒ¸è‚‰', calories: 165}, {name: 'å¯¿å¸', calories: 300}, {name: 'çƒ¤é¸¡èƒ¸è‚‰', calories: 180}, {name: 'è’¸é²ˆé±¼', calories: 150},
                {name: 'ç…ä¸‰æ–‡é±¼', calories: 280}, {name: 'è™¾ä»ç‚’è›‹', calories: 220}, {name: 'æ¸…è’¸è™¾', calories: 140}, {name: 'éº»è¾£çƒ«', calories: 400}
            ],
            // æ™šé¤é…èœï¼ˆè”¬èœç±»ã€æ±¤ç±»ï¼‰
            dinnerSide: [
                {name: 'è”¬èœæ²™æ‹‰', calories: 120}, {name: 'æ°´ç…®èœå¿ƒ', calories: 60}, {name: 'å‡‰æ‹Œé»„ç“œ', calories: 40}, {name: 'ç´«èœè›‹èŠ±æ±¤', calories: 80},
                {name: 'ç‚’æ—¶è”¬', calories: 100}, {name: 'è±†è…æ±¤', calories: 90}, {name: 'æ¸…ç‚’èŠ¦ç¬‹', calories: 70}, {name: 'è’¸è›‹ç¾¹', calories: 110},
                {name: 'èŒè‡æ±¤', calories: 50}, {name: 'çƒ¤è”¬èœ', calories: 130}, {name: 'ç™½ç¼èœå¿ƒ', calories: 55}, {name: 'å†¬ç“œæ±¤', calories: 45},
                {name: 'è’¸è±†è…', calories: 95}, {name: 'å‡‰æ‹Œæœ¨è€³', calories: 65}, {name: 'æµ·å¸¦æ±¤', calories: 50}, {name: 'ç•ªèŒ„è›‹æ±¤', calories: 85},
                {name: 'æ‹Œè èœ', calories: 60}, {name: 'è’¸å—ç“œ', calories: 75}, {name: 'ç™½ç²¥å°èœ', calories: 150}, {name: 'é…¸è¾£æ±¤', calories: 120},
                {name: 'è’¸é¸¡è›‹', calories: 100}, {name: 'å‡‰æ‹Œè±†èŠ½', calories: 55}
            ]
        };
        
        // åˆ¤æ–­æ˜¯å¦ä¸ºé€šç”¨æ¨èï¼ˆæ¨èç¾é£Ÿï¼‰
        const isGeneralRecommend = !msg.includes('æ—©é¤') && !msg.includes('åˆé¤') && !msg.includes('æ™šé¤');
        
        if (isGeneralRecommend) {
            // æ¨èç¾é£Ÿï¼šä»æ‰€æœ‰90ç§é£Ÿç‰©ä¸­éšæœºé€‰æ‹©3ç§
            const allFoods = [...foods.breakfast, ...foods.lunchMain, ...foods.lunchSide, ...foods.dinnerMain, ...foods.dinnerSide];
            const selected = [];
            const usedIndexes = new Set();
            
            // éšæœºé€‰æ‹©3ä¸ªä¸é‡å¤çš„é£Ÿç‰©
            while (selected.length < 3) {
                const randomIndex = Math.floor(Math.random() * allFoods.length);
                if (!usedIndexes.has(randomIndex)) {
                    usedIndexes.add(randomIndex);
                    selected.push(allFoods[randomIndex]);
                }
            }
            
            const totalCalories = selected.reduce((sum, food) => sum + food.calories, 0);
            const result = `ğŸ½ï¸ ä¸ºä½ æ¨è3æ¬¾ç¾é£Ÿï¼š\n\n` +
                `1ï¸âƒ£ ${selected[0].name}ï¼ˆ${selected[0].calories}å¡ï¼‰\n` +
                `2ï¸âƒ£ ${selected[1].name}ï¼ˆ${selected[1].calories}å¡ï¼‰\n` +
                `3ï¸âƒ£ ${selected[2].name}ï¼ˆ${selected[2].calories}å¡ï¼‰\n\n` +
                `ğŸ“Š æ€»çƒ­é‡ï¼š${totalCalories}å¡`;
            
            return {text: result, action: {type: 'foodRecommend', count: 3, foods: selected}};
        } else {
            // æ¨èæ—©é¤/åˆé¤/æ™šé¤
            let type = 'lunch';
            const hour = new Date().getHours();
            if (hour < 10) type = 'breakfast';
            else if (hour < 14) type = 'lunch';
            else type = 'dinner';
            if (msg.includes('æ—©é¤')) type = 'breakfast';
            if (msg.includes('åˆé¤')) type = 'lunch';
            if (msg.includes('æ™šé¤')) type = 'dinner';
            
            // æ—©é¤ï¼šæ¨è1ç§
            if (type === 'breakfast') {
                const food = foods.breakfast[Math.floor(Math.random() * foods.breakfast.length)];
                return {text: `æ¨èæ—©é¤ï¼š${food.name}ï¼ˆ${food.calories}å¡ï¼‰`, action: {type: 'foodRecommend'}};
            }
            // åˆé¤ï¼šæ¨è1ä¸ªä¸»é£Ÿ + 1ä¸ªé…èœ
            else if (type === 'lunch') {
                const mainFood = foods.lunchMain[Math.floor(Math.random() * foods.lunchMain.length)];
                const sideFood = foods.lunchSide[Math.floor(Math.random() * foods.lunchSide.length)];
                const totalCalories = mainFood.calories + sideFood.calories;
                return {
                    text: `ğŸœ æ¨èåˆé¤ï¼š\n\nğŸ– ä¸»é£Ÿï¼š${mainFood.name}ï¼ˆ${mainFood.calories}å¡ï¼‰\nğŸ¥— é…èœï¼š${sideFood.name}ï¼ˆ${sideFood.calories}å¡ï¼‰\n\nğŸ“Š æ€»çƒ­é‡ï¼š${totalCalories}å¡`,
                    action: {type: 'foodRecommend', foods: [mainFood, sideFood]}
                };
            }
            // æ™šé¤ï¼šæ¨è1ä¸ªä¸»é£Ÿ + 1ä¸ªé…èœ
            else {
                const mainFood = foods.dinnerMain[Math.floor(Math.random() * foods.dinnerMain.length)];
                const sideFood = foods.dinnerSide[Math.floor(Math.random() * foods.dinnerSide.length)];
                const totalCalories = mainFood.calories + sideFood.calories;
                return {
                    text: `ğŸŒ™ æ¨èæ™šé¤ï¼š\n\nğŸ– ä¸»é£Ÿï¼š${mainFood.name}ï¼ˆ${mainFood.calories}å¡ï¼‰\nğŸ¥— é…èœï¼š${sideFood.name}ï¼ˆ${sideFood.calories}å¡ï¼‰\n\nğŸ“Š æ€»çƒ­é‡ï¼š${totalCalories}å¡`,
                    action: {type: 'foodRecommend', foods: [mainFood, sideFood]}
                };
            }
        }
    }
    
    recipeQuery(msg) {
        const recipes = {
            // æ—©é¤ç±»ï¼ˆ30ç§ï¼‰
            'è±†æµ†æ²¹æ¡': {ingredients: ['è±†æµ†300ml', 'æ²¹æ¡2æ ¹'], steps: ['è±†æµ†åŠ çƒ­è‡³æ²¸è…¾', 'æ²¹æ¡åˆ‡æ®µ', 'è±†æµ†å€’ç¢—', 'æ²¹æ¡è˜¸é£Ÿ'], time: '5åˆ†é’Ÿ', calories: 350},
            'ä¸‰æ˜æ²»': {ingredients: ['åå¸2ç‰‡', 'é¸¡è›‹1ä¸ª', 'ç”Ÿèœ', 'ç•ªèŒ„', 'ç«è…¿ç‰‡'], steps: ['ç…é¸¡è›‹è‡³åŠç†Ÿ', 'åå¸çƒ¤è‡³é‡‘é»„', 'ä¾æ¬¡é“ºç”Ÿèœç•ªèŒ„ç«è…¿é¸¡è›‹', 'ç›–ä¸Šåå¸å¯¹è§’åˆ‡'], time: '10åˆ†é’Ÿ', calories: 280},
            'å°ç¬¼åŒ…': {ingredients: ['å°ç¬¼åŒ…10ä¸ª', 'é¦™é†‹', 'å§œä¸'], steps: ['è’¸é”…æ°´çƒ§å¼€', 'ç¬¼å±‰åˆ·æ²¹é˜²ç²˜', 'æ”¾å…¥å°ç¬¼åŒ…', 'å¤§ç«è’¸8åˆ†é’Ÿ', 'é…é†‹å§œä¸é£Ÿç”¨'], time: '10åˆ†é’Ÿ', calories: 320},
            'ç‡•éº¦ç²¥': {ingredients: ['ç‡•éº¦50g', 'ç‰›å¥¶200ml', 'èœ‚èœœ', 'åšæœ'], steps: ['ç‡•éº¦åŠ ç‰›å¥¶å…¥é”…', 'å°ç«ç…®5åˆ†é’Ÿæ…æ‹Œ', 'ç…®è‡³æµ“ç¨ ', 'åŠ èœ‚èœœè°ƒå‘³', 'æ’’åšæœç¢'], time: '8åˆ†é’Ÿ', calories: 150},
            'ç…é¥¼æœå­': {ingredients: ['é¢ç³Š200g', 'é¸¡è›‹2ä¸ª', 'æ²¹æ¡', 'è‘±èŠ±', 'ç”œé¢é…±'], steps: ['å¹³åº•é”…åˆ·æ²¹', 'å€’é¢ç³Šæ‘Šè–„', 'æ‰“å…¥é¸¡è›‹æŠ¹åŒ€', 'æ’’è‘±èŠ±æ”¾æ²¹æ¡', 'åˆ·é…±å¯¹æŠ˜å·èµ·'], time: '10åˆ†é’Ÿ', calories: 380},
            'çš®è›‹ç˜¦è‚‰ç²¥': {ingredients: ['å¤§ç±³100g', 'çš®è›‹2ä¸ª', 'ç˜¦è‚‰100g', 'å§œä¸', 'è‘±èŠ±'], steps: ['å¤§ç±³æ´—å‡€ç…®ç²¥', 'ç˜¦è‚‰åˆ‡ä¸è…Œåˆ¶', 'çš®è›‹åˆ‡å—', 'ç²¥ç…®ç¨ åŠ è‚‰ä¸çš®è›‹', 'ç…®5åˆ†é’Ÿæ’’è‘±èŠ±'], time: '40åˆ†é’Ÿ', calories: 220},
            'é¸¡è›‹çŒé¥¼': {ingredients: ['é¢é¥¼2å¼ ', 'é¸¡è›‹2ä¸ª', 'ç”Ÿèœ', 'ç”œé¢é…±'], steps: ['é¢é¥¼å°ç«çƒ™è‡³é¼“èµ·', 'ç”¨ç­·å­æˆ³æ´çŒè›‹æ¶²', 'ç…è‡³ä¸¤é¢é‡‘é»„', 'åˆ·é…±å·ç”Ÿèœ'], time: '12åˆ†é’Ÿ', calories: 340},
            'ç‰›å¥¶éº¦ç‰‡': {ingredients: ['å³é£Ÿéº¦ç‰‡50g', 'ç‰›å¥¶250ml', 'é¦™è•‰', 'åšæœ'], steps: ['éº¦ç‰‡å€’å…¥ç¢—ä¸­', 'ç‰›å¥¶åŠ çƒ­å€’å…¥', 'æ”¾é¦™è•‰ç‰‡', 'æ’’åšæœç¢'], time: '5åˆ†é’Ÿ', calories: 180},
            'è‚ ç²‰': {ingredients: ['ç±³æµ†300ml', 'è‚‰æœ«50g', 'è™¾ä»', 'è‘±èŠ±', 'é…±æ²¹'], steps: ['ç±³æµ†å€’ç›˜è’¸æˆè–„çš®', 'æ’’è‚‰æœ«è™¾ä»å·èµ·', 'ç»§ç»­è’¸3åˆ†é’Ÿ', 'åˆ‡æ®µæ·‹é…±æ²¹è‘±æ²¹'], time: '15åˆ†é’Ÿ', calories: 260},
            'åŒ…å­é¦’å¤´': {ingredients: ['åŒ…å­æˆ–é¦’å¤´4ä¸ª'], steps: ['è’¸é”…æ°´çƒ§å¼€', 'æ”¾å…¥åŒ…å­é¦’å¤´', 'å¤§ç«è’¸8åˆ†é’Ÿ', 'å‡ºé”…è£…ç›˜'], time: '10åˆ†é’Ÿ', calories: 300},
            'å…¨éº¦é¢åŒ…': {ingredients: ['å…¨éº¦é¢åŒ…2ç‰‡', 'èŠ±ç”Ÿé…±', 'é¦™è•‰1æ ¹'], steps: ['é¢åŒ…çƒ¤ç®±çƒ¤è‡³å¾®é»„', 'å‡åŒ€æŠ¹èŠ±ç”Ÿé…±', 'æ”¾é¦™è•‰ç‰‡', 'å¯¹åŠåˆ‡'], time: '5åˆ†é’Ÿ', calories: 240},
            'æ°´ç…®è›‹': {ingredients: ['é¸¡è›‹2-3ä¸ª'], steps: ['é¸¡è›‹æ´—å‡€å†·æ°´ä¸‹é”…', 'æ°´å¼€åç…®8åˆ†é’Ÿ', 'æå‡ºè¿‡å†·æ°´', 'å‰¥å£³é£Ÿç”¨'], time: '10åˆ†é’Ÿ', calories: 80},
            'è±†è…è„‘': {ingredients: ['å«©è±†è…1ç›’', 'æ¦¨èœç¢', 'è™¾çš®', 'è‘±èŠ±', 'é…±æ²¹'], steps: ['è±†è…å…¥ç¢—åŠ çƒ­', 'æ’’æ¦¨èœè™¾çš®', 'æµ‡çƒ­é…±æ²¹', 'æ’’è‘±èŠ±'], time: '5åˆ†é’Ÿ', calories: 120},
            'çƒ­å¹²é¢': {ingredients: ['ç¢±é¢200g', 'èŠéº»é…±', 'è¾£èåœä¸', 'è‘±èŠ±'], steps: ['é¢ç…®è‡³æ–­ç”Ÿæå‡º', 'æ‹Œå°‘è®¸æ²¹é˜²ç²˜', 'åŠ èŠéº»é…±æ‹ŒåŒ€', 'æ”¾é…èœåŠ è°ƒæ–™'], time: '10åˆ†é’Ÿ', calories: 420},
            'è›‹æŒ': {ingredients: ['è›‹æŒçš®6ä¸ª', 'ç‰›å¥¶150ml', 'è›‹é»„3ä¸ª', 'ç³–30g'], steps: ['è›‹é»„åŠ ç³–æ‰“åŒ€', 'å€’å…¥ç‰›å¥¶æ…æ‹Œè¿‡ç­›', 'å€’å…¥è›‹æŒçš®8åˆ†æ»¡', 'çƒ¤ç®±200åº¦çƒ¤20åˆ†é’Ÿ'], time: '25åˆ†é’Ÿ', calories: 250},
            'ç‰ç±³ç²¥': {ingredients: ['ç‰ç±³ç³50g', 'æ°´500ml', 'å†°ç³–'], steps: ['ç‰ç±³ç³æ´—å‡€åŠ æ°´', 'ç…®å¼€è½¬å°ç«ç…®30åˆ†é’Ÿ', 'åŠ å†°ç³–è°ƒå‘³'], time: '35åˆ†é’Ÿ', calories: 130},
            'ç”Ÿç…åŒ…': {ingredients: ['ç”Ÿç…åŒ…8ä¸ª', 'èŠéº»', 'è‘±èŠ±'], steps: ['å¹³åº•é”…åˆ·æ²¹çƒ§çƒ­', 'æ‘†æ”¾ç”Ÿç…åŒ…', 'åŠ æ°´è‡³1/3é«˜ç›–ç›–ç„–', 'æ°´å¹²æ’’èŠéº»è‘±èŠ±', 'ç…è‡³åº•éƒ¨é‡‘é»„'], time: '15åˆ†é’Ÿ', calories: 360},
            'ç‰›è§’åŒ…': {ingredients: ['ç‰›è§’åŒ…2ä¸ª', 'é»„æ²¹', 'æœé…±'], steps: ['ç‰›è§’åŒ…åˆ‡å¼€ä¸æ–­', 'çƒ¤ç®±çƒ¤3åˆ†é’Ÿ', 'æ¶‚æŠ¹é»„æ²¹å’Œæœé…±'], time: '5åˆ†é’Ÿ', calories: 310},
            'å—ç“œç²¥': {ingredients: ['å—ç“œ200g', 'å¤§ç±³50g', 'å†°ç³–'], steps: ['å—ç“œå»çš®åˆ‡å°å—', 'å¤§ç±³ç…®ç²¥åŠ å—ç“œ', 'ç…®è‡³è½¯çƒ‚åŠ å†°ç³–'], time: '30åˆ†é’Ÿ', calories: 140},
            'èŒ¶å¶è›‹': {ingredients: ['é¸¡è›‹6ä¸ª', 'çº¢èŒ¶', 'å…«è§’', 'é…±æ²¹', 'ç›'], steps: ['é¸¡è›‹ç…®ç†Ÿæ•²è£‚çº¹', 'åŠ èŒ¶å¶é¦™æ–™é…±æ²¹', 'ç…®30åˆ†é’Ÿæµ¸æ³¡å…¥å‘³'], time: '40åˆ†é’Ÿ', calories: 90},
            'ç´«è–¯ç²¥': {ingredients: ['ç´«è–¯100g', 'å¤§ç±³50g', 'å†°ç³–'], steps: ['ç´«è–¯å»çš®åˆ‡å°å—', 'ä¸å¤§ç±³ä¸€èµ·ç…®', 'ç…®è‡³è½¯çƒ‚åŠ å†°ç³–'], time: '30åˆ†é’Ÿ', calories: 160},
            'æ‰‹æŠ“é¥¼': {ingredients: ['æ‰‹æŠ“é¥¼1å¼ ', 'é¸¡è›‹1ä¸ª', 'ç”Ÿèœ', 'ç«è…¿'], steps: ['é¥¼ç…è‡³ä¸¤é¢é‡‘é»„', 'å¦ç…é¸¡è›‹', 'é¥¼ä¸Šæ”¾ç”Ÿèœç«è…¿é¸¡è›‹', 'å·èµ·åˆ‡æ®µ'], time: '8åˆ†é’Ÿ', calories: 330},
            'é²œå¥¶åå¸': {ingredients: ['åå¸2ç‰‡', 'ç‰›å¥¶100ml', 'é¸¡è›‹1ä¸ª', 'ç³–'], steps: ['é¸¡è›‹ç‰›å¥¶ç³–æ‰“åŒ€', 'åå¸è˜¸è›‹å¥¶æ¶²', 'å¹³åº•é”…ç…è‡³é‡‘é»„'], time: '10åˆ†é’Ÿ', calories: 270},
            'è’¸é¥º': {ingredients: ['é¥ºå­10ä¸ª', 'é¦™é†‹', 'è’œæ³¥'], steps: ['è’¸é”…æ°´çƒ§å¼€', 'ç¬¼å±‰åˆ·æ²¹æ‘†é¥ºå­', 'å¤§ç«è’¸10-12åˆ†é’Ÿ', 'é…è˜¸æ–™é£Ÿç”¨'], time: '12åˆ†é’Ÿ', calories: 290},
            'çº¢è±†ç²¥': {ingredients: ['çº¢è±†50g', 'å¤§ç±³50g', 'å†°ç³–'], steps: ['çº¢è±†æå‰æ³¡2å°æ—¶', 'åŠ å¤§ç±³å’Œæ°´ç…®', 'ç…®è‡³çº¢è±†å¼€èŠ±', 'åŠ å†°ç³–'], time: '50åˆ†é’Ÿ', calories: 170},
            'åŸ¹æ ¹è›‹': {ingredients: ['åŸ¹æ ¹3-4ç‰‡', 'é¸¡è›‹2ä¸ª', 'åå¸'], steps: ['åŸ¹æ ¹ç…è‡³ç„¦é¦™', 'ç…é¸¡è›‹', 'åå¸çƒ¤é¦™', 'æ‘†ç›˜ç»„åˆ'], time: '10åˆ†é’Ÿ', calories: 320},
            'ç³¯ç±³é¸¡': {ingredients: ['ç³¯ç±³200g', 'é¸¡è‚‰100g', 'é¦™è‡', 'è·å¶'], steps: ['ç³¯ç±³æ³¡è½¯è’¸ç†Ÿ', 'é¸¡è‚‰é¦™è‡ç‚’é¦™æ‹Œç³¯ç±³', 'è·å¶åŒ…å¥½è’¸20åˆ†é’Ÿ'], time: '60åˆ†é’Ÿ', calories: 380},
            'å¸Œè…Šé…¸å¥¶': {ingredients: ['å¸Œè…Šé…¸å¥¶200g', 'è“è“', 'èœ‚èœœ', 'åšæœ'], steps: ['é…¸å¥¶å€’ç¢—', 'æ”¾è“è“', 'æ·‹èœ‚èœœ', 'æ’’åšæœç¢'], time: '3åˆ†é’Ÿ', calories: 150},
            'è™¾é¥º': {ingredients: ['è™¾é¥º8ä¸ª', 'ç”ŸæŠ½', 'é¦™é†‹'], steps: ['è’¸é”…æ°´çƒ§å¼€', 'ç¬¼å±‰åˆ·æ²¹æ‘†è™¾é¥º', 'å¤§ç«è’¸8åˆ†é’Ÿ', 'é…é…±æ–™'], time: '10åˆ†é’Ÿ', calories: 200},
            'æ°´æœç‡•éº¦æ¯': {ingredients: ['ç‡•éº¦ç‰‡', 'é…¸å¥¶', 'é¦™è•‰', 'è“æœ'], steps: ['æ¯åº•é“ºç‡•éº¦å€’é…¸å¥¶', 'æ”¾é¦™è•‰ç‰‡å†å€’é…¸å¥¶', 'æ”¾è“æœæ·‹èœ‚èœœ'], time: '5åˆ†é’Ÿ', calories: 190},
            
            // åˆé¤ç±»ï¼ˆ30ç§ï¼‰
            'å®«ä¿é¸¡ä¸': {ingredients: ['é¸¡èƒ¸è‚‰200g', 'èŠ±ç”Ÿç±³50g', 'å¹²è¾£æ¤’', 'èŠ±æ¤’', 'è‘±å§œè’œ'], steps: ['é¸¡è‚‰åˆ‡ä¸è…Œåˆ¶15åˆ†é’Ÿ', 'è°ƒå®«ä¿æ±', 'çƒ­æ²¹ç‚¸èŠ±ç”Ÿç±³', 'ç‚’é¸¡ä¸è‡³å˜è‰²', 'ä¸‹å¹²è¾£æ¤’èŠ±æ¤’çˆ†é¦™', 'å€’å®«ä¿æ±åŠ èŠ±ç”Ÿç¿»ç‚’', 'æ”¶æ±å‡ºé”…'], time: '25åˆ†é’Ÿ', calories: 450},
            'ç•ªèŒ„ç‚’è›‹': {ingredients: ['é¸¡è›‹3ä¸ª', 'ç•ªèŒ„2ä¸ª', 'è‘±èŠ±', 'ç›', 'ç³–'], steps: ['é¸¡è›‹æ‰“æ•£åŠ ç›', 'ç•ªèŒ„åˆ‡å—', 'çƒ­æ²¹ç‚’è›‹è‡³7åˆ†ç†Ÿ', 'ç‚’ç•ªèŒ„åŠ ç³–', 'å€’å…¥é¸¡è›‹ç¿»ç‚’', 'æ’’è‘±èŠ±å‡ºé”…'], time: '10åˆ†é’Ÿ', calories: 200},
            'çº¢çƒ§è‚‰': {ingredients: ['äº”èŠ±è‚‰500g', 'å†°ç³–', 'é…±æ²¹', 'æ–™é…’', 'å…«è§’'], steps: ['äº”èŠ±è‚‰åˆ‡å—ç„¯æ°´', 'é”…ä¸­ç‚’ç³–è‰²', 'ä¸‹è‚‰å—ç¿»ç‚’ä¸Šè‰²', 'åŠ è°ƒæ–™å’Œæ°´', 'å°ç«ç‚–1å°æ—¶', 'å¤§ç«æ”¶æ±'], time: '80åˆ†é’Ÿ', calories: 550},
            'æ¸…è’¸é±¼': {ingredients: ['é²ˆé±¼1æ¡', 'å§œç‰‡', 'è‘±ä¸', 'è’¸é±¼è±‰æ²¹'], steps: ['é±¼æ´—å‡€ä¸¤é¢åˆ’åˆ€', 'é±¼èº«æ”¾å§œç‰‡', 'æ°´å¼€åè’¸8-10åˆ†é’Ÿ', 'å€’æ‰è’¸æ°´', 'é“ºè‘±ä¸æµ‡çƒ­æ²¹', 'æ·‹è’¸é±¼è±‰æ²¹'], time: '15åˆ†é’Ÿ', calories: 180},
            'éº»å©†è±†è…': {ingredients: ['å«©è±†è…400g', 'è‚‰æœ«80g', 'è±†ç“£é…±', 'èŠ±æ¤’ç²‰', 'è‘±å§œè’œ'], steps: ['è±†è…åˆ‡å—ç„¯æ°´', 'ç‚’è‚‰æœ«å˜è‰²', 'ä¸‹è±†ç“£é…±ç‚’çº¢æ²¹', 'åŠ æ°´å’Œè±†è…ç…®5åˆ†é’Ÿ', 'å‹¾èŠ¡æ’’èŠ±æ¤’ç²‰è‘±èŠ±'], time: '15åˆ†é’Ÿ', calories: 280},
            'ç³–é†‹é‡Œè„Š': {ingredients: ['é‡Œè„Šè‚‰300g', 'ç•ªèŒ„é…±', 'ç™½é†‹', 'ç³–', 'æ·€ç²‰'], steps: ['é‡Œè„Šåˆ‡æ¡è…Œåˆ¶', 'è£¹æ·€ç²‰ç‚¸é‡‘é»„', 'è°ƒç³–é†‹æ±', 'ç‚’é¦™ç•ªèŒ„é…±', 'å€’ç³–é†‹æ±ç…®å¼€', 'æ”¾é‡Œè„Šç¿»ç‚’å‡åŒ€'], time: '25åˆ†é’Ÿ', calories: 480},
            'é±¼é¦™è‚‰ä¸': {ingredients: ['çŒªè‚‰ä¸200g', 'æœ¨è€³', 'èƒ¡èåœ', 'æ³¡æ¤’', 'è‘±å§œè’œ'], steps: ['è‚‰ä¸è…Œåˆ¶', 'è°ƒé±¼é¦™æ±', 'ç‚’è‚‰ä¸å˜è‰²', 'ä¸‹é…èœç¿»ç‚’', 'å€’é±¼é¦™æ±', 'å¿«é€Ÿç¿»ç‚’æ”¶æ±'], time: '20åˆ†é’Ÿ', calories: 420},
            'é’æ¤’è‚‰ä¸': {ingredients: ['çŒªè‚‰ä¸200g', 'é’æ¤’3ä¸ª', 'è‘±å§œ', 'é…±æ²¹'], steps: ['è‚‰ä¸è…Œåˆ¶', 'é’æ¤’åˆ‡ä¸', 'ç‚’è‚‰ä¸è‡³å˜è‰²', 'ä¸‹é’æ¤’ç¿»ç‚’', 'åŠ è°ƒæ–™ç‚’åŒ€å‡ºé”…'], time: '12åˆ†é’Ÿ', calories: 350},
            'å›é”…è‚‰': {ingredients: ['äº”èŠ±è‚‰300g', 'é’è’œ', 'è±†ç“£é…±', 'è±†è±‰'], steps: ['äº”èŠ±è‚‰ç…®ç†Ÿåˆ‡ç‰‡', 'ç…¸ç‚’å‡ºæ²¹', 'ä¸‹è±†ç“£é…±è±†è±‰', 'ç‚’å‡ºçº¢æ²¹', 'åŠ é’è’œç¿»ç‚’å‡åŒ€'], time: '20åˆ†é’Ÿ', calories: 520},
            'æ°´ç…®è‚‰ç‰‡': {ingredients: ['çŒªè‚‰ç‰‡200g', 'ç™½èœ', 'è±†èŠ½', 'è¾£æ¤’', 'èŠ±æ¤’'], steps: ['è‚‰ç‰‡è…Œåˆ¶', 'ç™½èœè±†èŠ½ç„¯æ°´å«åº•', 'ç…®è‚‰ç‰‡è‡³ç†Ÿ', 'æ”¾é…èœä¸Š', 'æµ‡çƒ­æ²¹æ’’èŠ±æ¤’è¾£æ¤’'], time: '20åˆ†é’Ÿ', calories: 480},
            'é…¸èœé±¼': {ingredients: ['é±¼ç‰‡300g', 'é…¸èœ', 'è±†èŠ½', 'æ³¡æ¤’'], steps: ['é±¼ç‰‡è…Œåˆ¶', 'ç‚’é…¸èœæ³¡æ¤’', 'åŠ æ°´ç…®å¼€', 'ä¸‹è±†èŠ½ç…®ç†Ÿæå‡º', 'ç…®é±¼ç‰‡å€’ç¢—æµ‡çƒ­æ²¹'], time: '25åˆ†é’Ÿ', calories: 380},
            'åœŸè±†ç‚–ç‰›è‚‰': {ingredients: ['ç‰›è‚‰300g', 'åœŸè±†2ä¸ª', 'èƒ¡èåœ', 'è‘±å§œ'], steps: ['ç‰›è‚‰åˆ‡å—ç„¯æ°´', 'ç‚’é¦™è‘±å§œ', 'ä¸‹ç‰›è‚‰ç¿»ç‚’', 'åŠ æ°´ç‚–40åˆ†é’Ÿ', 'åŠ åœŸè±†èƒ¡èåœç‚–è½¯'], time: '60åˆ†é’Ÿ', calories: 420},
            'çº¢çƒ§èŒ„å­': {ingredients: ['èŒ„å­2ä¸ª', 'è‚‰æœ«', 'è’œæœ«', 'è±†ç“£é…±'], steps: ['èŒ„å­åˆ‡å—ç‚¸è½¯', 'ç‚’è‚‰æœ«', 'ä¸‹è±†ç“£é…±è’œæœ«', 'åŠ èŒ„å­ç¿»ç‚’', 'åŠ ç³–é†‹è°ƒå‘³'], time: '15åˆ†é’Ÿ', calories: 240},
            'è¥¿çº¢æŸ¿ç‰›è…©': {ingredients: ['ç‰›è…©500g', 'ç•ªèŒ„3ä¸ª', 'åœŸè±†', 'è‘±å§œ'], steps: ['ç‰›è…©åˆ‡å—ç„¯æ°´', 'ç‚’ç•ªèŒ„å‡ºæ±', 'ä¸‹ç‰›è…©ç¿»ç‚’', 'åŠ æ°´ç‚–1å°æ—¶', 'åŠ åœŸè±†ç‚–è½¯'], time: '90åˆ†é’Ÿ', calories: 400},
            'è’œè“‰è¥¿å…°èŠ±': {ingredients: ['è¥¿å…°èŠ±1ä¸ª', 'è’œæœ«', 'ç›', 'æ²¹'], steps: ['è¥¿å…°èŠ±åˆ‡å°æœµç„¯æ°´', 'çƒ­æ²¹çˆ†é¦™è’œæœ«', 'ä¸‹è¥¿å…°èŠ±ç¿»ç‚’', 'åŠ ç›ç‚’åŒ€å‡ºé”…'], time: '8åˆ†é’Ÿ', calories: 120},
            'æœ¨é¡»è‚‰': {ingredients: ['çŒªè‚‰ä¸', 'é¸¡è›‹2ä¸ª', 'æœ¨è€³', 'é»„ç“œ'], steps: ['é¸¡è›‹ç‚’ç†Ÿç››å‡º', 'ç‚’è‚‰ä¸å˜è‰²', 'ä¸‹æœ¨è€³é»„ç“œ', 'åŠ é¸¡è›‹è°ƒæ–™ç¿»ç‚’'], time: '15åˆ†é’Ÿ', calories: 380},
            'å¹²ç…¸è±†è§’': {ingredients: ['è±†è§’300g', 'è‚‰æœ«', 'å¹²è¾£æ¤’', 'è’œæœ«'], steps: ['è±†è§’ç…¸è‡³èµ·çš±', 'ç››å‡ºç‚’è‚‰æœ«', 'ä¸‹å¹²è¾£æ¤’è’œæœ«', 'åŠ è±†è§’ç¿»ç‚’è°ƒå‘³'], time: '18åˆ†é’Ÿ', calories: 220},
            'é¦™è‡ç‚–é¸¡': {ingredients: ['é¸¡å—500g', 'é¦™è‡', 'çº¢æ£', 'å§œç‰‡'], steps: ['é¸¡å—ç„¯æ°´', 'é¦™è‡æ³¡å‘', 'ç‚’é¦™å§œç‰‡ä¸‹é¸¡å—', 'åŠ æ°´ç‚–40åˆ†é’Ÿ', 'åŠ é¦™è‡çº¢æ£ç‚–20åˆ†é’Ÿ'], time: '70åˆ†é’Ÿ', calories: 360},
            'ä¸œå¡è‚‰': {ingredients: ['äº”èŠ±è‚‰500g', 'å†°ç³–', 'é…±æ²¹', 'æ–™é…’'], steps: ['äº”èŠ±è‚‰åˆ‡æ–¹å—ç„¯æ°´', 'ç…è‡³é‡‘é»„', 'åŠ è°ƒæ–™', 'å°ç«ç‚–2å°æ—¶', 'æ”¶æ±è‡³æµ“ç¨ '], time: '150åˆ†é’Ÿ', calories: 580},
            'å‰æ¤’é±¼å¤´': {ingredients: ['é±¼å¤´1ä¸ª', 'å‰æ¤’', 'è’œæœ«', 'å§œä¸'], steps: ['é±¼å¤´æ´—å‡€å‰–å¼€', 'æŠ¹ç›è…Œåˆ¶', 'é“ºå‰æ¤’è’œæœ«', 'è’¸15åˆ†é’Ÿ', 'æ·‹çƒ­æ²¹æ’’è‘±èŠ±'], time: '25åˆ†é’Ÿ', calories: 320},
            'å°ç‚’è‚‰': {ingredients: ['äº”èŠ±è‚‰200g', 'é’æ¤’', 'çº¢æ¤’', 'è’œè‹—'], steps: ['äº”èŠ±è‚‰åˆ‡ç‰‡ç…¸ç‚’å‡ºæ²¹', 'ä¸‹è±†è±‰', 'åŠ é’çº¢æ¤’', 'ä¸‹è’œè‹—ç¿»ç‚’å‡åŒ€'], time: '15åˆ†é’Ÿ', calories: 440},
            'è¾£å­é¸¡': {ingredients: ['é¸¡è…¿è‚‰300g', 'å¹²è¾£æ¤’', 'èŠ±æ¤’', 'è‘±å§œè’œ'], steps: ['é¸¡è‚‰åˆ‡å—è…Œåˆ¶', 'æ²¹ç‚¸è‡³é‡‘é»„', 'ç‚’è¾£æ¤’èŠ±æ¤’', 'ä¸‹é¸¡å—ç¿»ç‚’', 'æ’’èŠéº»'], time: '25åˆ†é’Ÿ', calories: 460},
            'å£æ°´é¸¡': {ingredients: ['é¸¡è…¿2ä¸ª', 'è¾£æ¤’æ²¹', 'èŠ±æ¤’æ²¹', 'è’œæ³¥'], steps: ['é¸¡è…¿ç…®ç†Ÿ', 'è¿‡å†°æ°´åˆ‡å—æ‘†ç›˜', 'è°ƒçº¢æ²¹æ±', 'æµ‡åœ¨é¸¡è‚‰ä¸Š'], time: '30åˆ†é’Ÿ', calories: 280},
            'ç™½ç¼è™¾': {ingredients: ['é²œè™¾300g', 'å§œç‰‡', 'è‘±æ®µ', 'æ–™é…’'], steps: ['è™¾æ´—å‡€å‰ªé¡»', 'æ°´çƒ§å¼€åŠ å§œè‘±æ–™é…’', 'ä¸‹è™¾ç…®2åˆ†é’Ÿ', 'è™¾å˜çº¢æå‡ºé…è˜¸æ–™'], time: '8åˆ†é’Ÿ', calories: 150},
            'èšæ²¹ç”Ÿèœ': {ingredients: ['ç”Ÿèœ300g', 'èšæ²¹', 'è’œæœ«', 'æ²¹'], steps: ['ç”Ÿèœæ´—å‡€', 'æ²¸æ°´ç„¯30ç§’', 'æå‡ºæ‘†ç›˜', 'è’œæœ«çˆ†é¦™åŠ èšæ²¹', 'æµ‡åœ¨ç”Ÿèœä¸Š'], time: '5åˆ†é’Ÿ', calories: 100},
            'æ¢…èœæ‰£è‚‰': {ingredients: ['äº”èŠ±è‚‰500g', 'æ¢…å¹²èœ', 'å†°ç³–', 'é…±æ²¹'], steps: ['äº”èŠ±è‚‰ç…®ç†Ÿåˆ‡ç‰‡', 'æŠ¹é…±æ²¹ç‚¸ä¸Šè‰²', 'æ¢…èœæ³¡å‘ç‚’é¦™', 'è‚‰ç‰‡æ’ç¢—ç›–æ¢…èœ', 'è’¸1å°æ—¶å€’æ‰£'], time: '120åˆ†é’Ÿ', calories: 560},
            'å’•å’¾è‚‰': {ingredients: ['çŒªè‚‰300g', 'è è', 'é’çº¢æ¤’', 'ç•ªèŒ„é…±'], steps: ['è‚‰åˆ‡å—è…Œåˆ¶è£¹æ·€ç²‰', 'ç‚¸è‡³é‡‘é»„', 'è°ƒç³–é†‹æ±', 'ç‚’ç•ªèŒ„é…±åŠ è èé’æ¤’', 'ä¸‹è‚‰å—ç¿»ç‚’'], time: '25åˆ†é’Ÿ', calories: 490},
            'ç›ç„—é¸¡': {ingredients: ['ä¸‰é»„é¸¡1åª', 'ç²—ç›2æ–¤', 'æ²™å§œç²‰'], steps: ['é¸¡æŠ¹ç›è…Œ2å°æ—¶', 'ç”¨çº¸åŒ…å¥½', 'ç²—ç›ç‚’çƒ­åŸ‹é¸¡', 'å°ç«ç„—40åˆ†é’Ÿ'], time: '60åˆ†é’Ÿ', calories: 380},
            'å¹²é”…èŠ±èœ': {ingredients: ['èŠ±èœ1ä¸ª', 'äº”èŠ±è‚‰', 'å¹²è¾£æ¤’', 'è±†è±‰'], steps: ['èŠ±èœæ’•å°æœµç„¯æ°´', 'ç…¸ç‚’äº”èŠ±è‚‰å‡ºæ²¹', 'ä¸‹è±†è±‰è¾£æ¤’', 'åŠ èŠ±èœç¿»ç‚’è°ƒå‘³'], time: '15åˆ†é’Ÿ', calories: 260},
            'é“æ¿ç‰›æŸ³': {ingredients: ['ç‰›æŸ³300g', 'æ´‹è‘±', 'é’æ¤’', 'é»‘èƒ¡æ¤’'], steps: ['ç‰›æŸ³åˆ‡æ¡è…Œåˆ¶', 'é“æ¿çƒ§çƒ­åˆ·æ²¹', 'ç…ç‰›æŸ³è‡³7åˆ†ç†Ÿ', 'åŠ æ´‹è‘±é’æ¤’', 'æ’’é»‘èƒ¡æ¤’ç¿»ç‚’'], time: '15åˆ†é’Ÿ', calories: 420},
            
            // æ™šé¤ç±»ï¼ˆ30ç§ï¼‰
            'è”¬èœæ²™æ‹‰': {ingredients: ['ç”Ÿèœ', 'ç•ªèŒ„', 'é»„ç“œ', 'ç´«ç”˜è“', 'æ²™æ‹‰é…±', 'æŸ æª¬æ±'], steps: ['æ‰€æœ‰è”¬èœæ´—å‡€', 'ç”Ÿèœæ’•ç‰‡å…¶ä»–åˆ‡å—', 'æ··åˆè£…ç›˜', 'åŠ æ²™æ‹‰é…±', 'æŒ¤æŸ æª¬æ±æ‹ŒåŒ€'], time: '5åˆ†é’Ÿ', calories: 120},
            'é¸¡èƒ¸è‚‰': {ingredients: ['é¸¡èƒ¸è‚‰200g', 'é»‘èƒ¡æ¤’', 'ç›', 'æ©„æ¦„æ²¹'], steps: ['é¸¡èƒ¸è‚‰ç”¨åˆ€èƒŒæ‹æ¾', 'æŠ¹ç›é»‘èƒ¡æ¤’è…Œ30åˆ†é’Ÿ', 'å¹³åº•é”…åˆ·æ²¹', 'ä¸­ç«ç…5åˆ†é’Ÿ', 'ç¿»é¢å†ç…5åˆ†é’Ÿ', 'åˆ‡ç‰‡è£…ç›˜'], time: '15åˆ†é’Ÿ', calories: 165},
            'éº»è¾£çƒ«': {ingredients: ['å„ç±»è”¬èœ', 'è±†åˆ¶å“', 'è‚‰ä¸¸', 'éº»è¾£åº•æ–™'], steps: ['æ°´çƒ§å¼€åŠ åº•æ–™', 'å…ˆç…®è‚‰ä¸¸3åˆ†é’Ÿ', 'å†ä¸‹è”¬èœè±†åˆ¶å“', 'ç…®ç†Ÿæå‡º', 'åŠ èŠéº»é¦™èœæ‹ŒåŒ€'], time: '15åˆ†é’Ÿ', calories: 400},
            'å¯¿å¸': {ingredients: ['ç±³é¥­', 'ç´«èœ', 'ä¸‰æ–‡é±¼', 'é»„ç“œ', 'å¯¿å¸é†‹'], steps: ['ç±³é¥­æ‹Œå¯¿å¸é†‹æ”¾å‡‰', 'ç´«èœé“ºç«¹å¸˜', 'é“ºç±³é¥­ç•™è¾¹', 'æ”¾é£Ÿæå·ç´§', 'åˆ‡æ®µæ‘†ç›˜'], time: '25åˆ†é’Ÿ', calories: 300},
            'çƒ¤é¸¡èƒ¸è‚‰': {ingredients: ['é¸¡èƒ¸è‚‰200g', 'è¿·è¿­é¦™', 'ç›', 'é»‘èƒ¡æ¤’', 'æ©„æ¦„æ²¹'], steps: ['é¸¡èƒ¸è‚‰è…Œåˆ¶30åˆ†é’Ÿ', 'çƒ¤ç®±é¢„çƒ­200åº¦', 'çƒ¤ç›˜é“ºé”¡çº¸åˆ·æ²¹', 'çƒ¤15åˆ†é’Ÿç¿»é¢', 'å†çƒ¤10åˆ†é’Ÿ'], time: '30åˆ†é’Ÿ', calories: 180},
            'æ°´ç…®èœå¿ƒ': {ingredients: ['èœå¿ƒ300g', 'è’œæœ«', 'ç›', 'æ²¹'], steps: ['èœå¿ƒæ´—å‡€åˆ‡æ®µ', 'æ°´çƒ§å¼€åŠ ç›æ²¹', 'ä¸‹èœå¿ƒç„¯1åˆ†é’Ÿ', 'æå‡ºæ‘†ç›˜', 'è’œæœ«çƒ­æ²¹æµ‡ä¸Š'], time: '5åˆ†é’Ÿ', calories: 60},
            'è’¸é²ˆé±¼': {ingredients: ['é²ˆé±¼1æ¡', 'å§œä¸', 'è‘±ä¸', 'è’¸é±¼è±‰æ²¹'], steps: ['é±¼æ´—å‡€åˆ’åˆ€æ”¾å§œç‰‡', 'è’¸é”…è’¸8åˆ†é’Ÿ', 'å€’æ‰è’¸æ°´', 'é“ºè‘±ä¸', 'æµ‡çƒ­æ²¹æ·‹è±‰æ²¹'], time: '15åˆ†é’Ÿ', calories: 150},
            'å‡‰æ‹Œé»„ç“œ': {ingredients: ['é»„ç“œ2æ ¹', 'è’œæœ«', 'é†‹', 'é¦™æ²¹', 'ç›'], steps: ['é»„ç“œæ‹ç¢åˆ‡æ®µ', 'åŠ è’œæœ«ç›', 'å€’é†‹é¦™æ²¹', 'æ‹ŒåŒ€è…Œ10åˆ†é’Ÿ'], time: '15åˆ†é’Ÿ', calories: 40},
            'ç´«èœè›‹èŠ±æ±¤': {ingredients: ['ç´«èœ', 'é¸¡è›‹2ä¸ª', 'è™¾çš®', 'è‘±èŠ±', 'ç›'], steps: ['æ°´çƒ§å¼€æ”¾ç´«èœè™¾çš®', 'é¸¡è›‹æ‰“æ•£', 'è¾¹æ…è¾¹å€’å…¥è›‹æ¶²', 'åŠ ç›æ’’è‘±èŠ±'], time: '5åˆ†é’Ÿ', calories: 80},
            'ç…ä¸‰æ–‡é±¼': {ingredients: ['ä¸‰æ–‡é±¼200g', 'æŸ æª¬', 'ç›', 'é»‘èƒ¡æ¤’'], steps: ['ä¸‰æ–‡é±¼æŠ¹ç›é»‘èƒ¡æ¤’', 'å¹³åº•é”…çƒ­æ²¹', 'çš®æœä¸‹ç…5åˆ†é’Ÿ', 'ç¿»é¢ç…3åˆ†é’Ÿ', 'æŒ¤æŸ æª¬æ±'], time: '12åˆ†é’Ÿ', calories: 280},
            'ç‚’æ—¶è”¬': {ingredients: ['è¥¿å…°èŠ±', 'èƒ¡èåœ', 'æœ¨è€³', 'è’œæœ«'], steps: ['è”¬èœæ´—å‡€åˆ‡å—', 'ç„¯æ°´æ–­ç”Ÿ', 'çƒ­æ²¹çˆ†è’œ', 'ä¸‹è”¬èœç¿»ç‚’', 'åŠ ç›è°ƒå‘³'], time: '8åˆ†é’Ÿ', calories: 100},
            'è±†è…æ±¤': {ingredients: ['å«©è±†è…1ç›’', 'é¦™è‡', 'è‘±èŠ±', 'ç›'], steps: ['è±†è…åˆ‡å—', 'é¦™è‡åˆ‡ç‰‡', 'æ°´çƒ§å¼€æ”¾é¦™è‡', 'åŠ è±†è…ç…®3åˆ†é’Ÿ', 'åŠ ç›æ’’è‘±èŠ±'], time: '10åˆ†é’Ÿ', calories: 90},
            'è™¾ä»ç‚’è›‹': {ingredients: ['è™¾ä»150g', 'é¸¡è›‹3ä¸ª', 'è‘±èŠ±', 'æ–™é…’'], steps: ['è™¾ä»ç”¨æ–™é…’è…Œåˆ¶', 'é¸¡è›‹æ‰“æ•£', 'ç‚’è›‹è‡³7åˆ†ç†Ÿç››å‡º', 'ç‚’è™¾ä»å˜è‰²', 'åŠ é¸¡è›‹ç¿»ç‚’'], time: '10åˆ†é’Ÿ', calories: 220},
            'æ¸…ç‚’èŠ¦ç¬‹': {ingredients: ['èŠ¦ç¬‹300g', 'è’œæœ«', 'ç›', 'æ²¹'], steps: ['èŠ¦ç¬‹å»è€æ ¹åˆ‡æ®µ', 'ç„¯æ°´30ç§’', 'çƒ­æ²¹çˆ†è’œ', 'ä¸‹èŠ¦ç¬‹ç¿»ç‚’', 'åŠ ç›å‡ºé”…'], time: '8åˆ†é’Ÿ', calories: 70},
            'è’¸è›‹ç¾¹': {ingredients: ['é¸¡è›‹2ä¸ª', 'æ¸©æ°´', 'ç›', 'é¦™æ²¹', 'é…±æ²¹'], steps: ['é¸¡è›‹æ‰“æ•£åŠ ç›', 'åŠ æ¸©æ°´1:1.5æ…åŒ€', 'è¿‡ç­›å€’ç¢—', 'ç›–ä¿é²œè†œè’¸10åˆ†é’Ÿ', 'æ·‹é¦™æ²¹é…±æ²¹'], time: '15åˆ†é’Ÿ', calories: 110},
            'èŒè‡æ±¤': {ingredients: ['å„ç§èŒè‡', 'å§œç‰‡', 'æ¸æ', 'ç›'], steps: ['èŒè‡æ´—å‡€æ’•å¼€', 'æ°´çƒ§å¼€æ”¾å§œç‰‡', 'åŠ èŒè‡ç…®5åˆ†é’Ÿ', 'åŠ ç›æ¸æ'], time: '10åˆ†é’Ÿ', calories: 50},
            'çƒ¤è”¬èœ': {ingredients: ['è¥¿è‘«èŠ¦', 'èŒ„å­', 'å½©æ¤’', 'æ©„æ¦„æ²¹', 'ç›'], steps: ['è”¬èœåˆ‡ç‰‡', 'åˆ·æ©„æ¦„æ²¹æ’’ç›', 'çƒ¤ç®±200åº¦', 'çƒ¤15åˆ†é’Ÿç¿»é¢', 'å†çƒ¤10åˆ†é’Ÿ'], time: '30åˆ†é’Ÿ', calories: 130},
            'ç™½ç¼èœå¿ƒ': {ingredients: ['èœå¿ƒ300g', 'è’œæœ«', 'ç”ŸæŠ½', 'æ²¹'], steps: ['èœå¿ƒæ´—å‡€', 'æ°´çƒ§å¼€åŠ ç›æ²¹', 'ç„¯1åˆ†é’Ÿæå‡º', 'æ‘†ç›˜', 'è’œæœ«çƒ­æ²¹åŠ ç”ŸæŠ½æµ‡ä¸Š'], time: '5åˆ†é’Ÿ', calories: 55},
            'å†¬ç“œæ±¤': {ingredients: ['å†¬ç“œ300g', 'è™¾çš®', 'è‘±èŠ±', 'ç›'], steps: ['å†¬ç“œå»çš®åˆ‡ç‰‡', 'æ°´çƒ§å¼€æ”¾è™¾çš®', 'åŠ å†¬ç“œç…®5åˆ†é’Ÿ', 'åŠ ç›æ’’è‘±èŠ±'], time: '10åˆ†é’Ÿ', calories: 45},
            'è’¸è±†è…': {ingredients: ['å«©è±†è…1ç›’', 'è‘±èŠ±', 'ç”ŸæŠ½', 'é¦™æ²¹'], steps: ['è±†è…åˆ‡å—æ‘†ç›˜', 'è’¸é”…è’¸5åˆ†é’Ÿ', 'æ·‹ç”ŸæŠ½é¦™æ²¹', 'æ’’è‘±èŠ±'], time: '8åˆ†é’Ÿ', calories: 95},
            'å‡‰æ‹Œæœ¨è€³': {ingredients: ['æœ¨è€³', 'é»„ç“œ', 'è’œæœ«', 'é†‹', 'é¦™æ²¹'], steps: ['æœ¨è€³æ³¡å‘ç„¯æ°´', 'é»„ç“œåˆ‡ä¸', 'åŠ è’œæœ«é†‹é¦™æ²¹', 'æ‹ŒåŒ€å³å¯'], time: '10åˆ†é’Ÿ', calories: 65},
            'æµ·å¸¦æ±¤': {ingredients: ['æµ·å¸¦', 'è±†è…', 'è‘±èŠ±', 'ç›'], steps: ['æµ·å¸¦æ³¡å‘åˆ‡ä¸', 'è±†è…åˆ‡å—', 'æ°´çƒ§å¼€æ”¾æµ·å¸¦', 'åŠ è±†è…ç…®5åˆ†é’Ÿ', 'åŠ ç›æ’’è‘±èŠ±'], time: '15åˆ†é’Ÿ', calories: 50},
            'æ¸…è’¸è™¾': {ingredients: ['é²œè™¾300g', 'å§œç‰‡', 'è‘±æ®µ', 'æ–™é…’'], steps: ['è™¾æ´—å‡€å‰ªé¡»', 'æ‘†ç›˜æ”¾å§œè‘±', 'æ·‹æ–™é…’', 'è’¸é”…è’¸5åˆ†é’Ÿ', 'é…å§œé†‹æ±'], time: '8åˆ†é’Ÿ', calories: 140},
            'ç•ªèŒ„è›‹æ±¤': {ingredients: ['ç•ªèŒ„2ä¸ª', 'é¸¡è›‹2ä¸ª', 'è‘±èŠ±', 'ç›'], steps: ['ç•ªèŒ„åˆ‡å—', 'æ°´çƒ§å¼€æ”¾ç•ªèŒ„', 'ç…®å‡ºæ±', 'å€’å…¥è›‹æ¶²', 'åŠ ç›æ’’è‘±èŠ±'], time: '8åˆ†é’Ÿ', calories: 85},
            'æ‹Œè èœ': {ingredients: ['è èœ300g', 'è’œæœ«', 'é¦™æ²¹', 'ç›'], steps: ['è èœæ´—å‡€ç„¯æ°´', 'è¿‡å†·æ°´æŒ¤å¹²', 'åˆ‡æ®µåŠ è’œæœ«', 'æ‹Œé¦™æ²¹ç›'], time: '10åˆ†é’Ÿ', calories: 60},
            'è’¸å—ç“œ': {ingredients: ['å—ç“œ300g', 'æ¸æ', 'èœ‚èœœ'], steps: ['å—ç“œå»çš®åˆ‡å—', 'æ‘†ç›˜', 'è’¸é”…è’¸15åˆ†é’Ÿ', 'æ’’æ¸ææ·‹èœ‚èœœ'], time: '18åˆ†é’Ÿ', calories: 75},
            'ç™½ç²¥å°èœ': {ingredients: ['å¤§ç±³50g', 'æ¦¨èœ', 'è±†è…ä¹³', 'èŠ±ç”Ÿç±³'], steps: ['å¤§ç±³æ´—å‡€', 'åŠ æ°´ç…®ç²¥', 'å°ç«ç…®40åˆ†é’Ÿ', 'é…å°èœé£Ÿç”¨'], time: '45åˆ†é’Ÿ', calories: 150},
            'é…¸è¾£æ±¤': {ingredients: ['è±†è…', 'æœ¨è€³', 'é¸¡è›‹', 'é†‹', 'èƒ¡æ¤’ç²‰'], steps: ['è±†è…æœ¨è€³åˆ‡ä¸', 'æ°´çƒ§å¼€æ”¾ææ–™', 'å‹¾èŠ¡', 'å€’è›‹æ¶²', 'åŠ é†‹èƒ¡æ¤’ç²‰'], time: '12åˆ†é’Ÿ', calories: 120},
            'è’¸é¸¡è›‹': {ingredients: ['é¸¡è›‹2ä¸ª', 'æ¸©æ°´', 'ç›', 'é…±æ²¹'], steps: ['é¸¡è›‹æ‰“æ•£åŠ ç›', 'åŠ æ¸©æ°´æ…åŒ€è¿‡ç­›', 'ç›–ä¿é²œè†œè’¸10åˆ†é’Ÿ', 'æ·‹é…±æ²¹é¦™æ²¹'], time: '15åˆ†é’Ÿ', calories: 100},
            'å‡‰æ‹Œè±†èŠ½': {ingredients: ['è±†èŠ½300g', 'è’œæœ«', 'é†‹', 'é¦™æ²¹'], steps: ['è±†èŠ½ç„¯æ°´1åˆ†é’Ÿ', 'è¿‡å†·æ°´æ²¥å¹²', 'åŠ è’œæœ«é†‹é¦™æ²¹', 'æ‹ŒåŒ€å³å¯'], time: '8åˆ†é’Ÿ', calories: 55}
        };
        let name = null;
        for (let key in recipes) {
            if (msg.includes(key)) { name = key; break; }
        }
        if (!name) return {text: 'âŒ è¯¥èœè°±æš‚æœªæ”¶å½•\n\nğŸ“– ç›®å‰æ”¯æŒæŸ¥è¯¢æ‰€æœ‰90ç§èœå“ï¼\n\nğŸ’¡ è¯•è¯•è¿™äº›ï¼š\nâ€¢ æ—©é¤ï¼šç‡•éº¦ç²¥ã€è±†æµ†æ²¹æ¡ã€å°ç¬¼åŒ…ã€ç…é¥¼æœå­\nâ€¢ åˆé¤ï¼šå®«ä¿é¸¡ä¸ã€ç•ªèŒ„ç‚’è›‹ã€çº¢çƒ§è‚‰ã€æ¸…è’¸é±¼\nâ€¢ æ™šé¤ï¼šè”¬èœæ²™æ‹‰ã€é¸¡èƒ¸è‚‰ã€å¯¿å¸ã€çƒ¤é¸¡èƒ¸è‚‰', action: {type: 'recipeQuery'}};
        const r = recipes[name];
        return {text: `ğŸ“– ${name}çš„åšæ³•ï¼š\n\nâ±ï¸ ç”¨æ—¶ï¼š${r.time}\nğŸ”¥ çƒ­é‡ï¼š${r.calories}å¡\n\nğŸ¥˜ é£Ÿæï¼š\n${r.ingredients.map(i => '  â€¢ ' + i).join('\n')}\n\nğŸ‘¨â€ğŸ³ æ­¥éª¤ï¼š\n${r.steps.map((s, i) => `${i + 1}. ${s}`).join('\n')}`, action: {type: 'recipeQuery'}};
    }
    
    nutritionAnalysis(msg) {
        // ç›´æ¥è°ƒç”¨è¯¦ç»†è¥å…»åŠŸèƒ½
        return this.detailedNutrition(msg);
    }
    
    mealRecord(msg) {
        const match = msg.match(/åƒäº†(.+)/);
        if (!match) return {text: 'è¯·å‘Šè¯‰æˆ‘åƒäº†ä»€ä¹ˆ', action: {type: 'mealRecord'}};
        const foodInput = match[1].trim();
        
        // æ‰€æœ‰90ç§èœå“çš„çƒ­é‡æ•°æ®
        const foodCalories = {
            'è±†æµ†æ²¹æ¡': 350, 'ä¸‰æ˜æ²»': 280, 'å°ç¬¼åŒ…': 320, 'ç‡•éº¦ç²¥': 150, 'ç…é¥¼æœå­': 380, 'çš®è›‹ç˜¦è‚‰ç²¥': 220, 'é¸¡è›‹çŒé¥¼': 340, 'ç‰›å¥¶éº¦ç‰‡': 180, 'è‚ ç²‰': 260, 'åŒ…å­é¦’å¤´': 300,
            'å…¨éº¦é¢åŒ…': 240, 'æ°´ç…®è›‹': 80, 'è±†è…è„‘': 120, 'çƒ­å¹²é¢': 420, 'è›‹æŒ': 250, 'ç‰ç±³ç²¥': 130, 'ç”Ÿç…åŒ…': 360, 'ç‰›è§’åŒ…': 310, 'å—ç“œç²¥': 140, 'èŒ¶å¶è›‹': 90,
            'ç´«è–¯ç²¥': 160, 'æ‰‹æŠ“é¥¼': 330, 'é²œå¥¶åå¸': 270, 'è’¸é¥º': 290, 'çº¢è±†ç²¥': 170, 'åŸ¹æ ¹è›‹': 320, 'ç³¯ç±³é¸¡': 380, 'å¸Œè…Šé…¸å¥¶': 150, 'è™¾é¥º': 200, 'æ°´æœç‡•éº¦æ¯': 190,
            'å®«ä¿é¸¡ä¸': 450, 'ç•ªèŒ„ç‚’è›‹': 200, 'çº¢çƒ§è‚‰': 550, 'æ¸…è’¸é±¼': 180, 'éº»å©†è±†è…': 280, 'ç³–é†‹é‡Œè„Š': 480, 'é±¼é¦™è‚‰ä¸': 420, 'é’æ¤’è‚‰ä¸': 350, 'å›é”…è‚‰': 520, 'æ°´ç…®è‚‰ç‰‡': 480,
            'é…¸èœé±¼': 380, 'åœŸè±†ç‚–ç‰›è‚‰': 420, 'çº¢çƒ§èŒ„å­': 240, 'è¥¿çº¢æŸ¿ç‰›è…©': 400, 'è’œè“‰è¥¿å…°èŠ±': 120, 'æœ¨é¡»è‚‰': 380, 'å¹²ç…¸è±†è§’': 220, 'é¦™è‡ç‚–é¸¡': 360, 'ä¸œå¡è‚‰': 580, 'å‰æ¤’é±¼å¤´': 320,
            'å°ç‚’è‚‰': 440, 'è¾£å­é¸¡': 460, 'å£æ°´é¸¡': 280, 'ç™½ç¼è™¾': 150, 'èšæ²¹ç”Ÿèœ': 100, 'æ¢…èœæ‰£è‚‰': 560, 'å’•å’¾è‚‰': 490, 'ç›ç„—é¸¡': 380, 'å¹²é”…èŠ±èœ': 260, 'é“æ¿ç‰›æŸ³': 420,
            'è”¬èœæ²™æ‹‰': 120, 'é¸¡èƒ¸è‚‰': 165, 'éº»è¾£çƒ«': 400, 'å¯¿å¸': 300, 'çƒ¤é¸¡èƒ¸è‚‰': 180, 'æ°´ç…®èœå¿ƒ': 60, 'è’¸é²ˆé±¼': 150, 'å‡‰æ‹Œé»„ç“œ': 40, 'ç´«èœè›‹èŠ±æ±¤': 80, 'ç…ä¸‰æ–‡é±¼': 280,
            'ç‚’æ—¶è”¬': 100, 'è±†è…æ±¤': 90, 'è™¾ä»ç‚’è›‹': 220, 'æ¸…ç‚’èŠ¦ç¬‹': 70, 'è’¸è›‹ç¾¹': 110, 'èŒè‡æ±¤': 50, 'çƒ¤è”¬èœ': 130, 'ç™½ç¼èœå¿ƒ': 55, 'å†¬ç“œæ±¤': 45, 'è’¸è±†è…': 95,
            'å‡‰æ‹Œæœ¨è€³': 65, 'æµ·å¸¦æ±¤': 50, 'æ¸…è’¸è™¾': 140, 'ç•ªèŒ„è›‹æ±¤': 85, 'æ‹Œè èœ': 60, 'è’¸å—ç“œ': 75, 'ç™½ç²¥å°èœ': 150, 'é…¸è¾£æ±¤': 120, 'è’¸é¸¡è›‹': 100, 'å‡‰æ‹Œè±†èŠ½': 55
        };
        
        // æŸ¥æ‰¾åŒ¹é…çš„èœå“
        let foodName = foodInput;
        let calories = 200; // é»˜è®¤çƒ­é‡
        
        for (let key in foodCalories) {
            if (foodInput.includes(key)) {
                foodName = key;
                calories = foodCalories[key];
                break;
            }
        }
        
        const record = {id: Date.now(), date: new Date().toLocaleDateString(), time: new Date().toLocaleTimeString(), food: foodName, calories: calories};
        this.mealRecords.unshift(record);
        this.saveData();
        const today = this.mealRecords.filter(r => r.date === record.date);
        const total = today.reduce((sum, r) => sum + r.calories, 0);
        return {text: `âœ… å·²è®°å½•ï¼š${foodName}\n\nğŸ“Š æœ¬é¤çƒ­é‡ï¼š${calories}å¡\nğŸ“… ä»Šæ—¥æ€»è®¡ï¼š${total}å¡`, action: {type: 'mealRecord', record}};
    }
    
    calorieCalculator(msg) {
        const match = msg.match(/(\d+)/);
        const calories = match ? parseInt(match[0]) : 300;
        const exercises = [{name: 'è·‘æ­¥', time: Math.round(calories / 10)}, {name: 'å¿«èµ°', time: Math.round(calories / 5)}];
        return {text: `æ¶ˆè€—${calories}å¡éœ€è¦ï¼š\n${exercises.map(e => `${e.name}ï¼š${e.time}åˆ†é’Ÿ`).join('\n')}`, action: {type: 'calorieCalculator'}};
    }
    
    viewRecords() {
        if (this.mealRecords.length === 0) return {text: 'æš‚æ— è®°å½•', action: {type: 'viewRecords'}};
        const recent = this.mealRecords.slice(0, 10);
        let text = 'æœ€è¿‘è®°å½•ï¼š\n';
        recent.forEach(r => { text += `${r.date} ${r.time} - ${r.food} (${r.calories}å¡)\n`; });
        return {text, action: {type: 'viewRecords'}};
    }
    
    showHelp() {
        return {text: 'ğŸ” ç¾é£Ÿæ™ºèƒ½åŠ©æ‰‹åŠŸèƒ½åˆ—è¡¨ï¼š\n\nğŸ¯ åŸºç¡€åŠŸèƒ½ï¼š\n1. æ¨èæ—©é¤/åˆé¤/æ™šé¤\n2. æŸ¥è¯¢èœè°±ï¼ˆå¦‚ï¼šç•ªèŒ„ç‚’è›‹æ€ä¹ˆåšï¼‰\n3. è®°å½•é¥®é£Ÿï¼ˆå¦‚ï¼šè®°å½•åƒäº†ç•ªèŒ„ç‚’è›‹ï¼‰\n4. è®¡ç®—çƒ­é‡ï¼ˆå¦‚ï¼šè®¡ç®—300å¡è·¯é‡Œï¼‰\n5. æŸ¥çœ‹è®°å½•\n\nâœ¨ é«˜çº§åŠŸèƒ½ï¼š\n6. è¯¦ç»†è¥å…»åˆ†æï¼ˆå¦‚ï¼šå®«ä¿é¸¡ä¸æœ‰å“ªäº›è¥å…»ï¼‰\n7. ä¸€å‘¨é¥®é£Ÿè®¡åˆ’ï¼ˆå¦‚ï¼šç”Ÿæˆä¸€å‘¨å‡è„‚è®¡åˆ’ï¼‰\n8. è¿åŠ¨è®°å½•ï¼ˆå¦‚ï¼šè®°å½•è¿åŠ¨è·‘æ­¥30åˆ†é’Ÿï¼‰\n9. æŸ¥çœ‹æ‰€æœ‰èœå“ï¼ˆè¾“å…¥ï¼šèœå“åˆ—è¡¨ï¼‰', action: {type: 'help'}};
    }
    
    showAllFoods() {
        const breakfastFoods = [
            'è±†æµ†æ²¹æ¡', 'ä¸‰æ˜æ²»', 'å°ç¬¼åŒ…', 'ç‡•éº¦ç²¥', 'ç…é¥¼æœå­',
            'çš®è›‹ç˜¦è‚‰ç²¥', 'é¸¡è›‹çŒé¥¼', 'ç‰›å¥¶éº¦ç‰‡', 'è‚ ç²‰', 'åŒ…å­é¦’å¤´',
            'å…¨éº¦é¢åŒ…', 'æ°´ç…®è›‹', 'è±†è…è„‘', 'çƒ­å¹²é¢', 'è›‹æŒ',
            'ç‰ç±³ç²¥', 'ç”Ÿç…åŒ…', 'ç‰›è§’åŒ…', 'å—ç“œç²¥', 'èŒ¶å¶è›‹',
            'ç´«è–¯ç²¥', 'æ‰‹æŠ“é¥¼', 'é²œå¥¶åå¸', 'è’¸é¥º', 'çº¢è±†ç²¥',
            'åŸ¹æ ¹è›‹', 'ç³¯ç±³é¸¡', 'å¸Œè…Šé…¸å¥¶', 'è™¾é¥º', 'æ°´æœç‡•éº¦æ¯'
        ];
        
        const lunchFoods = [
            'å®«ä¿é¸¡ä¸', 'ç•ªèŒ„ç‚’è›‹', 'çº¢çƒ§è‚‰', 'æ¸…è’¸é±¼', 'éº»å©†è±†è…',
            'ç³–é†‹é‡Œè„Š', 'é±¼é¦™è‚‰ä¸', 'é’æ¤’è‚‰ä¸', 'å›é”…è‚‰', 'æ°´ç…®è‚‰ç‰‡',
            'é…¸èœé±¼', 'åœŸè±†ç‚–ç‰›è‚‰', 'çº¢çƒ§èŒ„å­', 'è¥¿çº¢æŸ¿ç‰›è…©', 'è’œè“‰è¥¿å…°èŠ±',
            'æœ¨é¡»è‚‰', 'å¹²ç…¸è±†è§’', 'é¦™è‡ç‚–é¸¡', 'ä¸œå¡è‚‰', 'å‰æ¤’é±¼å¤´',
            'å°ç‚’è‚‰', 'è¾£å­é¸¡', 'å£æ°´é¸¡', 'ç™½ç¼è™¾', 'èšæ²¹ç”Ÿèœ',
            'æ¢…èœæ‰£è‚‰', 'å’•å’¾è‚‰', 'ç›ç„—é¸¡', 'å¹²é”…èŠ±èœ', 'é“æ¿ç‰›æŸ³'
        ];
        
        const dinnerFoods = [
            'è”¬èœæ²™æ‹‰', 'é¸¡èƒ¸è‚‰', 'éº»è¾£çƒ«', 'å¯¿å¸', 'çƒ¤é¸¡èƒ¸è‚‰',
            'æ°´ç…®èœå¿ƒ', 'è’¸é²ˆé±¼', 'å‡‰æ‹Œé»„ç“œ', 'ç´«èœè›‹èŠ±æ±¤', 'ç…ä¸‰æ–‡é±¼',
            'ç‚’æ—¶è”¬', 'è±†è…æ±¤', 'è™¾ä»ç‚’è›‹', 'æ¸…ç‚’èŠ¦ç¬‹', 'è’¸è›‹ç¾¹',
            'èŒè‡æ±¤', 'çƒ¤è”¬èœ', 'ç™½ç¼èœå¿ƒ', 'å†¬ç“œæ±¤', 'è’¸è±†è…',
            'å‡‰æ‹Œæœ¨è€³', 'æµ·å¸¦æ±¤', 'æ¸…è’¸è™¾', 'ç•ªèŒ„è›‹æ±¤', 'æ‹Œè èœ',
            'è’¸å—ç“œ', 'ç™½ç²¥å°èœ', 'é…¸è¾£æ±¤', 'è’¸é¸¡è›‹', 'å‡‰æ‹Œè±†èŠ½'
        ];
        
        let text = 'ğŸ“‹ ç¾é£Ÿæ™ºèƒ½åŠ©æ‰‹ - å·²æ”¶å½•èœå“åˆ—è¡¨\n\n';
        text += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n';
        
        text += 'ğŸŒ… æ—©é¤ç±»ï¼ˆ30ç§ï¼‰ï¼š\n';
        breakfastFoods.forEach((food, index) => {
            text += `${index + 1}. ${food}`;
            if ((index + 1) % 5 === 0 || index === breakfastFoods.length - 1) {
                text += '\n';
            } else {
                text += '  ';
            }
        });
        
        text += '\nğŸœ åˆé¤ç±»ï¼ˆ30ç§ï¼‰ï¼š\n';
        lunchFoods.forEach((food, index) => {
            text += `${index + 1}. ${food}`;
            if ((index + 1) % 5 === 0 || index === lunchFoods.length - 1) {
                text += '\n';
            } else {
                text += '  ';
            }
        });
        
        text += '\nğŸŒ™ æ™šé¤ç±»ï¼ˆ30ç§ï¼‰ï¼š\n';
        dinnerFoods.forEach((food, index) => {
            text += `${index + 1}. ${food}`;
            if ((index + 1) % 5 === 0 || index === dinnerFoods.length - 1) {
                text += '\n';
            } else {
                text += '  ';
            }
        });
        
        text += '\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n';
        text += 'ğŸ“Š æ•°æ®ç»Ÿè®¡ï¼š\n';
        text += `â€¢ æ€»èœå“æ•°ï¼š90ç§\n`;
        text += `â€¢ æ—©é¤ï¼š30ç§  åˆé¤ï¼š30ç§  æ™šé¤ï¼š30ç§\n\n`;
        
        text += 'âœ¨ æ”¯æŒçš„åŠŸèƒ½ï¼š\n';
        text += `â€¢ èœè°±æŸ¥è¯¢ï¼šè¾“å…¥"èœè°±+èœå"æˆ–"èœå+æ€ä¹ˆåš"\n`;
        text += `â€¢ è¥å…»åˆ†æï¼šè¾“å…¥"è¯¦ç»†è¥å…»+èœå"\n`;
        text += `â€¢ é¥®é£Ÿè®°å½•ï¼šè¾“å…¥"è®°å½•åƒäº†+èœå"\n`;
        text += `â€¢ ç¾é£Ÿæ¨èï¼šè¾“å…¥"æ¨èç¾é£Ÿ"æˆ–"æ¨èæ—©é¤/åˆé¤/æ™šé¤"\n`;
        text += `â€¢ ä¸€å‘¨è®¡åˆ’ï¼šè¾“å…¥"ç”Ÿæˆä¸€å‘¨å‡è„‚/å¢è‚Œè®¡åˆ’"\n\n`;
        
        text += 'âš ï¸ æ•°æ®è¯´æ˜ï¼š\n';
        text += `ç”±äºæ•°æ®æœ‰é™ï¼Œæœ¬ç³»ç»Ÿç›®å‰ä»…æ”¯æŒä»¥ä¸Š90ç§èœå“çš„å®Œæ•´åŠŸèƒ½ã€‚\n`;
        text += `åŒ…æ‹¬ï¼šè¯¦ç»†èœè°±ã€è¥å…»åˆ†æã€çƒ­é‡è®¡ç®—ã€é¥®é£Ÿè®°å½•ç­‰ã€‚\n`;
        text += `å¦‚éœ€æŸ¥è¯¢å…¶ä»–èœå“ï¼Œæš‚æ—¶æ— æ³•æä¾›ç›¸å…³æ•°æ®ã€‚\n\n`;
        
        text += 'ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹ï¼š\n';
        text += `â€¢ "ç•ªèŒ„ç‚’è›‹æ€ä¹ˆåš" - æŸ¥çœ‹åšæ³•\n`;
        text += `â€¢ "å®«ä¿é¸¡ä¸æœ‰å“ªäº›è¥å…»" - æŸ¥çœ‹è¥å…»æˆåˆ†\n`;
        text += `â€¢ "è®°å½•åƒäº†æ¸…è’¸é±¼" - è®°å½•é¥®é£Ÿ\n`;
        text += `â€¢ "æ¨èç¾é£Ÿ" - éšæœºæ¨è3ç§ç¾é£Ÿ`;
        
        return {text, action: {type: 'showAllFoods'}};
    }
    
    chat() {
        return {text: 'ä½ å¥½ï¼æˆ‘å¯ä»¥å¸®ä½ æ¨èç¾é£Ÿã€æŸ¥è¯¢èœè°±ã€è®°å½•é¥®é£Ÿã€‚è¯•è¯•è¯´"æ¨èæ—©é¤"æˆ–"å¸®åŠ©"', action: {type: 'chat'}};
    }
    
    async processWithAI(msg) {
        try {
            if (typeof API_CONFIG === 'undefined') throw new Error('No API config');
            const config = API_CONFIG[this.aiProvider];
            const messages = [{role: 'system', content: 'ä½ æ˜¯ç¾é£ŸåŠ©æ‰‹'}, {role: 'user', content: msg}];
            const res = await fetch(`${config.baseURL}/chat/completions`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${config.apiKey}`},
                body: JSON.stringify({model: config.model, messages: messages, max_tokens: 500})
            });
            if (!res.ok) throw new Error('API error');
            const data = await res.json();
            return {text: data.choices[0].message.content, action: {type: 'ai_chat'}};
        } catch (e) {
            return this.processLocal(msg);
        }
    }
    
    detailedNutrition(msg) {
        const nutritionDB = {
            // æ—©é¤ç±»
            'è±†æµ†æ²¹æ¡': {calories: 350, protein: 10, fat: 18, carbs: 40, fiber: 2},
            'ä¸‰æ˜æ²»': {calories: 280, protein: 12, fat: 12, carbs: 32, fiber: 3},
            'å°ç¬¼åŒ…': {calories: 320, protein: 11, fat: 15, carbs: 38, fiber: 2},
            'ç‡•éº¦ç²¥': {calories: 150, protein: 6, fat: 3, carbs: 27, fiber: 4},
            'ç…é¥¼æœå­': {calories: 380, protein: 11, fat: 16, carbs: 48, fiber: 2},
            'çš®è›‹ç˜¦è‚‰ç²¥': {calories: 220, protein: 13, fat: 8, carbs: 28, fiber: 1},
            'é¸¡è›‹çŒé¥¼': {calories: 340, protein: 12, fat: 15, carbs: 40, fiber: 2},
            'ç‰›å¥¶éº¦ç‰‡': {calories: 180, protein: 8, fat: 4, carbs: 30, fiber: 3},
            'è‚ ç²‰': {calories: 260, protein: 8, fat: 10, carbs: 36, fiber: 1},
            'åŒ…å­é¦’å¤´': {calories: 300, protein: 9, fat: 8, carbs: 50, fiber: 2},
            'å…¨éº¦é¢åŒ…': {calories: 240, protein: 9, fat: 3, carbs: 45, fiber: 5},
            'æ°´ç…®è›‹': {calories: 80, protein: 7, fat: 5, carbs: 1, fiber: 0},
            'è±†è…è„‘': {calories: 120, protein: 8, fat: 6, carbs: 10, fiber: 2},
            'çƒ­å¹²é¢': {calories: 420, protein: 12, fat: 18, carbs: 55, fiber: 3},
            'è›‹æŒ': {calories: 250, protein: 5, fat: 14, carbs: 28, fiber: 1},
            'ç‰ç±³ç²¥': {calories: 130, protein: 4, fat: 2, carbs: 26, fiber: 3},
            'ç”Ÿç…åŒ…': {calories: 360, protein: 12, fat: 16, carbs: 42, fiber: 2},
            'ç‰›è§’åŒ…': {calories: 310, protein: 6, fat: 16, carbs: 36, fiber: 2},
            'å—ç“œç²¥': {calories: 140, protein: 3, fat: 1, carbs: 30, fiber: 3},
            'èŒ¶å¶è›‹': {calories: 90, protein: 7, fat: 6, carbs: 1, fiber: 0},
            'ç´«è–¯ç²¥': {calories: 160, protein: 3, fat: 1, carbs: 36, fiber: 4},
            'æ‰‹æŠ“é¥¼': {calories: 330, protein: 8, fat: 15, carbs: 42, fiber: 2},
            'é²œå¥¶åå¸': {calories: 270, protein: 8, fat: 8, carbs: 42, fiber: 2},
            'è’¸é¥º': {calories: 290, protein: 11, fat: 12, carbs: 36, fiber: 2},
            'çº¢è±†ç²¥': {calories: 170, protein: 5, fat: 1, carbs: 36, fiber: 4},
            'åŸ¹æ ¹è›‹': {calories: 320, protein: 18, fat: 22, carbs: 12, fiber: 1},
            'ç³¯ç±³é¸¡': {calories: 380, protein: 14, fat: 16, carbs: 45, fiber: 2},
            'å¸Œè…Šé…¸å¥¶': {calories: 150, protein: 12, fat: 6, carbs: 15, fiber: 0},
            'è™¾é¥º': {calories: 200, protein: 10, fat: 6, carbs: 28, fiber: 1},
            'æ°´æœç‡•éº¦æ¯': {calories: 190, protein: 6, fat: 4, carbs: 35, fiber: 5},
            
            // åˆé¤ç±»
            'å®«ä¿é¸¡ä¸': {calories: 450, protein: 28, fat: 22, carbs: 35, fiber: 3},
            'ç•ªèŒ„ç‚’è›‹': {calories: 200, protein: 12, fat: 14, carbs: 8, fiber: 2},
            'çº¢çƒ§è‚‰': {calories: 550, protein: 20, fat: 45, carbs: 15, fiber: 1},
            'æ¸…è’¸é±¼': {calories: 180, protein: 25, fat: 8, carbs: 2, fiber: 0},
            'éº»å©†è±†è…': {calories: 280, protein: 15, fat: 18, carbs: 12, fiber: 3},
            'ç³–é†‹é‡Œè„Š': {calories: 480, protein: 22, fat: 24, carbs: 42, fiber: 2},
            'é±¼é¦™è‚‰ä¸': {calories: 420, protein: 24, fat: 22, carbs: 32, fiber: 3},
            'é’æ¤’è‚‰ä¸': {calories: 350, protein: 22, fat: 18, carbs: 25, fiber: 3},
            'å›é”…è‚‰': {calories: 520, protein: 22, fat: 38, carbs: 22, fiber: 2},
            'æ°´ç…®è‚‰ç‰‡': {calories: 480, protein: 26, fat: 32, carbs: 20, fiber: 3},
            'é…¸èœé±¼': {calories: 380, protein: 28, fat: 20, carbs: 18, fiber: 2},
            'åœŸè±†ç‚–ç‰›è‚‰': {calories: 420, protein: 24, fat: 22, carbs: 32, fiber: 3},
            'çº¢çƒ§èŒ„å­': {calories: 240, protein: 4, fat: 16, carbs: 22, fiber: 4},
            'è¥¿çº¢æŸ¿ç‰›è…©': {calories: 400, protein: 26, fat: 20, carbs: 28, fiber: 3},
            'è’œè“‰è¥¿å…°èŠ±': {calories: 120, protein: 5, fat: 6, carbs: 12, fiber: 4},
            'æœ¨é¡»è‚‰': {calories: 380, protein: 22, fat: 20, carbs: 28, fiber: 3},
            'å¹²ç…¸è±†è§’': {calories: 220, protein: 6, fat: 14, carbs: 18, fiber: 4},
            'é¦™è‡ç‚–é¸¡': {calories: 360, protein: 28, fat: 18, carbs: 20, fiber: 3},
            'ä¸œå¡è‚‰': {calories: 580, protein: 18, fat: 48, carbs: 18, fiber: 1},
            'å‰æ¤’é±¼å¤´': {calories: 320, protein: 24, fat: 18, carbs: 15, fiber: 2},
            'å°ç‚’è‚‰': {calories: 440, protein: 24, fat: 26, carbs: 28, fiber: 2},
            'è¾£å­é¸¡': {calories: 460, protein: 26, fat: 28, carbs: 26, fiber: 2},
            'å£æ°´é¸¡': {calories: 280, protein: 26, fat: 14, carbs: 12, fiber: 2},
            'ç™½ç¼è™¾': {calories: 150, protein: 28, fat: 3, carbs: 2, fiber: 0},
            'èšæ²¹ç”Ÿèœ': {calories: 100, protein: 3, fat: 6, carbs: 8, fiber: 3},
            'æ¢…èœæ‰£è‚‰': {calories: 560, protein: 20, fat: 46, carbs: 16, fiber: 2},
            'å’•å’¾è‚‰': {calories: 490, protein: 20, fat: 28, carbs: 42, fiber: 2},
            'ç›ç„—é¸¡': {calories: 380, protein: 32, fat: 22, carbs: 12, fiber: 1},
            'å¹²é”…èŠ±èœ': {calories: 260, protein: 8, fat: 16, carbs: 22, fiber: 4},
            'é“æ¿ç‰›æŸ³': {calories: 420, protein: 28, fat: 24, carbs: 22, fiber: 2},
            
            // æ™šé¤ç±»
            'è”¬èœæ²™æ‹‰': {calories: 120, protein: 3, fat: 8, carbs: 10, fiber: 4},
            'é¸¡èƒ¸è‚‰': {calories: 165, protein: 31, fat: 3.6, carbs: 0, fiber: 0},
            'éº»è¾£çƒ«': {calories: 400, protein: 18, fat: 20, carbs: 35, fiber: 4},
            'å¯¿å¸': {calories: 300, protein: 12, fat: 5, carbs: 55, fiber: 2},
            'çƒ¤é¸¡èƒ¸è‚‰': {calories: 180, protein: 32, fat: 4, carbs: 2, fiber: 0},
            'æ°´ç…®èœå¿ƒ': {calories: 60, protein: 2, fat: 3, carbs: 6, fiber: 2},
            'è’¸é²ˆé±¼': {calories: 150, protein: 26, fat: 5, carbs: 1, fiber: 0},
            'å‡‰æ‹Œé»„ç“œ': {calories: 40, protein: 1, fat: 2, carbs: 5, fiber: 2},
            'ç´«èœè›‹èŠ±æ±¤': {calories: 80, protein: 6, fat: 4, carbs: 6, fiber: 1},
            'ç…ä¸‰æ–‡é±¼': {calories: 280, protein: 28, fat: 18, carbs: 0, fiber: 0},
            'ç‚’æ—¶è”¬': {calories: 100, protein: 3, fat: 5, carbs: 10, fiber: 3},
            'è±†è…æ±¤': {calories: 90, protein: 8, fat: 5, carbs: 6, fiber: 2},
            'è™¾ä»ç‚’è›‹': {calories: 220, protein: 20, fat: 12, carbs: 8, fiber: 1},
            'æ¸…ç‚’èŠ¦ç¬‹': {calories: 70, protein: 3, fat: 4, carbs: 6, fiber: 3},
            'è’¸è›‹ç¾¹': {calories: 110, protein: 8, fat: 7, carbs: 4, fiber: 0},
            'èŒè‡æ±¤': {calories: 50, protein: 3, fat: 2, carbs: 6, fiber: 2},
            'çƒ¤è”¬èœ': {calories: 130, protein: 4, fat: 6, carbs: 15, fiber: 4},
            'ç™½ç¼èœå¿ƒ': {calories: 55, protein: 2, fat: 3, carbs: 5, fiber: 2},
            'å†¬ç“œæ±¤': {calories: 45, protein: 2, fat: 1, carbs: 8, fiber: 2},
            'è’¸è±†è…': {calories: 95, protein: 9, fat: 5, carbs: 4, fiber: 2},
            'å‡‰æ‹Œæœ¨è€³': {calories: 65, protein: 2, fat: 3, carbs: 8, fiber: 3},
            'æµ·å¸¦æ±¤': {calories: 50, protein: 2, fat: 1, carbs: 9, fiber: 3},
            'æ¸…è’¸è™¾': {calories: 140, protein: 26, fat: 3, carbs: 2, fiber: 0},
            'ç•ªèŒ„è›‹æ±¤': {calories: 85, protein: 6, fat: 5, carbs: 6, fiber: 1},
            'æ‹Œè èœ': {calories: 60, protein: 3, fat: 3, carbs: 6, fiber: 3},
            'è’¸å—ç“œ': {calories: 75, protein: 2, fat: 0.5, carbs: 17, fiber: 3},
            'ç™½ç²¥å°èœ': {calories: 150, protein: 4, fat: 2, carbs: 32, fiber: 1},
            'é…¸è¾£æ±¤': {calories: 120, protein: 6, fat: 5, carbs: 14, fiber: 2},
            'è’¸é¸¡è›‹': {calories: 100, protein: 8, fat: 7, carbs: 2, fiber: 0},
            'å‡‰æ‹Œè±†èŠ½': {calories: 55, protein: 3, fat: 2, carbs: 7, fiber: 3}
        };
        
        let foodName = null;
        for (let key in nutritionDB) {
            if (msg.includes(key)) {
                foodName = key;
                break;
            }
        }
        
        if (!foodName) {
            return {text: 'âŒ è¯¥èœå“æš‚æ— è¯¦ç»†è¥å…»æ•°æ®\n\nğŸ’¡ ç›®å‰æ”¯æŒæŸ¥è¯¢æ‰€æœ‰90ç§èœå“ï¼\n\nğŸ“ è¯•è¯•è¿™äº›ï¼š\nâ€¢ æ—©é¤ï¼šç‡•éº¦ç²¥ã€è±†æµ†æ²¹æ¡ã€å…¨éº¦é¢åŒ…\nâ€¢ åˆé¤ï¼šå®«ä¿é¸¡ä¸ã€æ¸…è’¸é±¼ã€ç•ªèŒ„ç‚’è›‹\nâ€¢ æ™šé¤ï¼šé¸¡èƒ¸è‚‰ã€è”¬èœæ²™æ‹‰ã€æ¸…è’¸è™¾', action: {type: 'detailedNutrition'}};
        }
        
        const n = nutritionDB[foodName];
        
        // è®¡ç®—å¥åº·è¯„åˆ†
        let score = 0;
        if (n.protein >= 20) score += 25;
        else if (n.protein >= 15) score += 20;
        else if (n.protein >= 10) score += 15;
        else score += 10;
        
        if (n.fiber >= 3) score += 25;
        else if (n.fiber >= 2) score += 20;
        else if (n.fiber >= 1) score += 15;
        else score += 10;
        
        if (n.calories <= 200) score += 25;
        else if (n.calories <= 350) score += 20;
        else if (n.calories <= 500) score += 15;
        else score += 10;
        
        if (n.fat <= 10) score += 25;
        else if (n.fat <= 20) score += 20;
        else if (n.fat <= 30) score += 15;
        else score += 10;
        
        let text = `ğŸ“Š ${foodName} - è¯¦ç»†è¥å…»åˆ†æ\n\n`;
        text += `ğŸ”¥ çƒ­é‡ï¼š${n.calories}å¡\n`;
        text += `ğŸ¥© è›‹ç™½è´¨ï¼š${n.protein}g\n`;
        text += `ğŸ§ˆ è„‚è‚ªï¼š${n.fat}g\n`;
        text += `ğŸš ç¢³æ°´åŒ–åˆç‰©ï¼š${n.carbs}g\n`;
        text += `ğŸŒ¾ è†³é£Ÿçº¤ç»´ï¼š${n.fiber}g\n\n`;
        text += `â­ å¥åº·è¯„åˆ†ï¼š${score}/100åˆ†\n\n`;
        text += `ğŸ’¡ è¥å…»å»ºè®®ï¼š\n`;
        
        if (n.protein >= 20) text += `âœ… è›‹ç™½è´¨å«é‡ä¼˜ç§€ï¼Œæœ‰åŠ©äºè‚Œè‚‰ç”Ÿé•¿\n`;
        else if (n.protein < 10) text += `âš ï¸ è›‹ç™½è´¨åä½ï¼Œå»ºè®®æ­é…é«˜è›‹ç™½é£Ÿç‰©\n`;
        
        if (n.fiber >= 3) text += `âœ… è†³é£Ÿçº¤ç»´ä¸°å¯Œï¼Œä¿ƒè¿›æ¶ˆåŒ–\n`;
        else if (n.fiber < 2) text += `âš ï¸ çº¤ç»´å«é‡è¾ƒä½ï¼Œå»ºè®®å¤šåƒè”¬èœ\n`;
        
        if (n.fat > 30) text += `âš ï¸ è„‚è‚ªå«é‡è¾ƒé«˜ï¼Œå‡è„‚æœŸæ…é£Ÿ\n`;
        else if (n.fat < 10) text += `âœ… ä½è„‚é£Ÿç‰©ï¼Œé€‚åˆå‡è„‚\n`;
        
        if (n.carbs > 50) text += `âš ï¸ ç¢³æ°´è¾ƒé«˜ï¼Œç³–å°¿ç—…æ‚£è€…æ…é£Ÿ\n`;
        
        return {text, action: {type: 'detailedNutrition', nutrition: n, score}};
    }
    
    generateWeeklyPlan(msg) {
        // è¯†åˆ«ç›®æ ‡
        let goal = 'maintain';
        let targetCalories = 2000;
        
        if (msg.includes('å‡è„‚') || msg.includes('å‡è‚¥') || msg.includes('ç˜¦èº«')) {
            goal = 'lose';
            targetCalories = 1500;
        } else if (msg.includes('å¢è‚Œ') || msg.includes('å¢é‡') || msg.includes('å¢åŠ ')) {
            goal = 'gain';
            targetCalories = 2500;
        }
        
        this.userProfile.goal = goal;
        this.userProfile.dailyCalorieTarget = targetCalories;
        
        // é£Ÿç‰©æ•°æ®åº“ï¼ˆæ‰©å±•ç‰ˆï¼Œæ¯ç±»15ç§ï¼‰
        const breakfastFoods = [
            {name: 'ç‡•éº¦ç²¥', calories: 150}, {name: 'å…¨éº¦é¢åŒ…', calories: 240}, {name: 'æ°´ç…®è›‹', calories: 80},
            {name: 'è±†æµ†æ²¹æ¡', calories: 350}, {name: 'ä¸‰æ˜æ²»', calories: 280}, {name: 'ç‰›å¥¶éº¦ç‰‡', calories: 180},
            {name: 'çš®è›‹ç˜¦è‚‰ç²¥', calories: 220}, {name: 'å¸Œè…Šé…¸å¥¶', calories: 150}, {name: 'æ°´æœç‡•éº¦æ¯', calories: 190},
            {name: 'å°ç¬¼åŒ…', calories: 320}, {name: 'ç…é¥¼æœå­', calories: 380}, {name: 'é¸¡è›‹çŒé¥¼', calories: 340},
            {name: 'è±†è…è„‘', calories: 120}, {name: 'ç‰ç±³ç²¥', calories: 130}, {name: 'å—ç“œç²¥', calories: 140}
        ];
        
        const lunchFoods = [
            {name: 'æ¸…è’¸é±¼', calories: 180}, {name: 'ç•ªèŒ„ç‚’è›‹', calories: 200}, {name: 'å®«ä¿é¸¡ä¸', calories: 450},
            {name: 'éº»å©†è±†è…', calories: 280}, {name: 'è’œè“‰è¥¿å…°èŠ±', calories: 120}, {name: 'ç™½ç¼è™¾', calories: 150},
            {name: 'é’æ¤’è‚‰ä¸', calories: 350}, {name: 'é¦™è‡ç‚–é¸¡', calories: 360}, {name: 'èšæ²¹ç”Ÿèœ', calories: 100},
            {name: 'é±¼é¦™è‚‰ä¸', calories: 420}, {name: 'ç³–é†‹é‡Œè„Š', calories: 480}, {name: 'åœŸè±†ç‚–ç‰›è‚‰', calories: 420},
            {name: 'çº¢çƒ§èŒ„å­', calories: 240}, {name: 'è¥¿çº¢æŸ¿ç‰›è…©', calories: 400}, {name: 'æœ¨é¡»è‚‰', calories: 380}
        ];
        
        const dinnerFoods = [
            {name: 'è”¬èœæ²™æ‹‰', calories: 120}, {name: 'é¸¡èƒ¸è‚‰', calories: 165}, {name: 'è’¸é²ˆé±¼', calories: 150},
            {name: 'è±†è…æ±¤', calories: 90}, {name: 'æ¸…ç‚’èŠ¦ç¬‹', calories: 70}, {name: 'è’¸è›‹ç¾¹', calories: 110},
            {name: 'èŒè‡æ±¤', calories: 50}, {name: 'çƒ¤è”¬èœ', calories: 130}, {name: 'ç´«èœè›‹èŠ±æ±¤', calories: 80},
            {name: 'çƒ¤é¸¡èƒ¸è‚‰', calories: 180}, {name: 'æ°´ç…®èœå¿ƒ', calories: 60}, {name: 'å‡‰æ‹Œé»„ç“œ', calories: 40},
            {name: 'ç…ä¸‰æ–‡é±¼', calories: 280}, {name: 'ç‚’æ—¶è”¬', calories: 100}, {name: 'è™¾ä»ç‚’è›‹', calories: 220}
        ];
        
        // ç”Ÿæˆ7å¤©è®¡åˆ’ï¼ˆæ ¹æ®ç›®æ ‡çƒ­é‡æ™ºèƒ½é€‰æ‹©ï¼‰
        const plan = [];
        const days = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
        
        for (let i = 0; i < 7; i++) {
            let breakfast, lunch, dinner, total;
            let attempts = 0;
            const maxAttempts = 20;
            
            // å°è¯•å¤šæ¬¡ï¼Œæ‰¾åˆ°æ¥è¿‘ç›®æ ‡çƒ­é‡çš„ç»„åˆ
            do {
                breakfast = breakfastFoods[Math.floor(Math.random() * breakfastFoods.length)];
                lunch = lunchFoods[Math.floor(Math.random() * lunchFoods.length)];
                dinner = dinnerFoods[Math.floor(Math.random() * dinnerFoods.length)];
                total = breakfast.calories + lunch.calories + dinner.calories;
                attempts++;
                
                // æ£€æŸ¥æ˜¯å¦æ¥è¿‘ç›®æ ‡çƒ­é‡ï¼ˆå…è®¸Â±200å¡çš„è¯¯å·®ï¼‰
                const difference = Math.abs(total - targetCalories);
                if (difference <= 200 || attempts >= maxAttempts) {
                    break;
                }
            } while (true);
            
            plan.push({
                day: days[i],
                breakfast: breakfast,
                lunch: lunch,
                dinner: dinner,
                total: total
            });
        }
        
        this.weeklyPlan = plan;
        
        // ç”Ÿæˆæ–‡æœ¬
        let text = `ğŸ“… ä¸€å‘¨é¥®é£Ÿè®¡åˆ’ï¼ˆ${goal === 'lose' ? 'å‡è„‚' : goal === 'gain' ? 'å¢è‚Œ' : 'ç»´æŒ'}ï¼‰\n`;
        text += `ğŸ¯ æ¯æ—¥ç›®æ ‡ï¼š${targetCalories}å¡\n\n`;
        
        plan.forEach(day => {
            text += `${day.day}ï¼š\n`;
            text += `  æ—©é¤ï¼š${day.breakfast.name}ï¼ˆ${day.breakfast.calories}å¡ï¼‰\n`;
            text += `  åˆé¤ï¼š${day.lunch.name}ï¼ˆ${day.lunch.calories}å¡ï¼‰\n`;
            text += `  æ™šé¤ï¼š${day.dinner.name}ï¼ˆ${day.dinner.calories}å¡ï¼‰\n`;
            text += `  åˆè®¡ï¼š${day.total}å¡\n\n`;
        });
        
        text += `ğŸ’¡ æç¤ºï¼šè®¡åˆ’å·²ç”Ÿæˆï¼ŒåšæŒæ‰§è¡Œå¯è¾¾æˆç›®æ ‡ï¼`;
        
        return {text, action: {type: 'weeklyPlan', plan}};
    }
    
    recordExercise(msg) {
        // è¿åŠ¨æ•°æ®åº“
        const exerciseDB = {
            'è·‘æ­¥': {caloriesPerMin: 10, type: 'æœ‰æ°§'},
            'å¿«èµ°': {caloriesPerMin: 5, type: 'æœ‰æ°§'},
            'æ•£æ­¥': {caloriesPerMin: 3, type: 'æœ‰æ°§'},
            'æ¸¸æ³³': {caloriesPerMin: 12, type: 'æœ‰æ°§'},
            'éª‘è¡Œ': {caloriesPerMin: 8, type: 'æœ‰æ°§'},
            'è·³ç»³': {caloriesPerMin: 13, type: 'æœ‰æ°§'},
            'ç‘œä¼½': {caloriesPerMin: 3, type: 'æŸ”éŸ§'},
            'æ™®æ‹‰æ': {caloriesPerMin: 4, type: 'æŸ”éŸ§'},
            'å¤ªæ': {caloriesPerMin: 2.5, type: 'æŸ”éŸ§'},
            'åŠ›é‡è®­ç»ƒ': {caloriesPerMin: 6, type: 'åŠ›é‡'},
            'ç¯®çƒ': {caloriesPerMin: 9, type: 'çƒç±»'},
            'è¶³çƒ': {caloriesPerMin: 10, type: 'çƒç±»'},
            'ç¾½æ¯›çƒ': {caloriesPerMin: 7, type: 'çƒç±»'},
            'ç½‘çƒ': {caloriesPerMin: 8, type: 'çƒç±»'},
            'ä¹’ä¹“çƒ': {caloriesPerMin: 5, type: 'çƒç±»'},
            'çˆ¬æ¥¼æ¢¯': {caloriesPerMin: 8, type: 'æœ‰æ°§'},
            'è·³èˆ': {caloriesPerMin: 6, type: 'æœ‰æ°§'},
            'å¥èº«æ“': {caloriesPerMin: 7, type: 'æœ‰æ°§'},
            'çˆ¬å±±': {caloriesPerMin: 9, type: 'æœ‰æ°§'},
            'å¾’æ­¥': {caloriesPerMin: 4.5, type: 'æœ‰æ°§'},
            'æ‹³å‡»': {caloriesPerMin: 11, type: 'åŠ›é‡'},
            'æ»‘å†°': {caloriesPerMin: 7, type: 'æœ‰æ°§'}
        };
        
        // è¯†åˆ«è¿åŠ¨ç±»å‹å’Œæ—¶é•¿
        let exerciseName = null;
        let duration = 0;
        
        for (let key in exerciseDB) {
            if (msg.includes(key)) {
                exerciseName = key;
                break;
            }
        }
        
        // è¯†åˆ«æ—¶é•¿ï¼šæ”¯æŒå¤šç§è¡¨è¾¾æ–¹å¼
        // 1. ç›´æ¥æ•°å­—+åˆ†é’Ÿï¼š30åˆ†é’Ÿã€40åˆ†é’Ÿ
        let match = msg.match(/(\d+)\s*åˆ†é’Ÿ/);
        if (match) {
            duration = parseInt(match[1]);
        }
        
        // 2. å°æ—¶ï¼š1å°æ—¶ã€2å°æ—¶
        if (duration === 0) {
            match = msg.match(/(\d+)\s*å°æ—¶/);
            if (match) {
                duration = parseInt(match[1]) * 60;
            }
        }
        
        // 3. åŠå°æ—¶
        if (duration === 0 && msg.includes('åŠå°æ—¶')) {
            duration = 30;
        }
        
        // 4. ä¸€å°æ—¶ã€ä¸¤å°æ—¶ï¼ˆä¸­æ–‡æ•°å­—ï¼‰
        if (duration === 0) {
            const chineseNumbers = {'ä¸€': 1, 'äºŒ': 2, 'ä¸¤': 2, 'ä¸‰': 3, 'å››': 4, 'äº”': 5};
            for (let chinese in chineseNumbers) {
                if (msg.includes(chinese + 'å°æ—¶')) {
                    duration = chineseNumbers[chinese] * 60;
                    break;
                }
            }
        }
        
        if (!exerciseName || duration === 0) {
            return {text: 'âŒ æ²¡è¯†åˆ«åˆ°è¿åŠ¨ä¿¡æ¯å“¦ï½\n\nğŸ’¡ è¯•è¯•è¿™æ ·è¯´ï¼š\nâ€¢ "è·‘æ­¥30åˆ†é’Ÿ"\nâ€¢ "æˆ‘æ¸¸æ³³äº†1å°æ—¶"\nâ€¢ "åˆšæ‰“ç¯®çƒ40åˆ†é’Ÿ"\nâ€¢ "ä»Šå¤©è·³ç»³åŠå°æ—¶"\nâ€¢ "æ•£æ­¥45åˆ†é’Ÿ"\nâ€¢ "æ‰“å¤ªæ1å°æ—¶"\n\nğŸ’ª æ”¯æŒçš„è¿åŠ¨ï¼ˆå…±22ç§ï¼‰ï¼š\nğŸƒ æœ‰æ°§è¿åŠ¨ï¼šè·‘æ­¥ã€å¿«èµ°ã€æ•£æ­¥ã€æ¸¸æ³³ã€éª‘è¡Œã€è·³ç»³ã€çˆ¬æ¥¼æ¢¯ã€è·³èˆã€å¥èº«æ“ã€çˆ¬å±±ã€å¾’æ­¥ã€æ»‘å†°\nğŸ§˜ æŸ”éŸ§è¿åŠ¨ï¼šç‘œä¼½ã€æ™®æ‹‰æã€å¤ªæ\nğŸ’ª åŠ›é‡è¿åŠ¨ï¼šåŠ›é‡è®­ç»ƒã€æ‹³å‡»\nâš½ çƒç±»è¿åŠ¨ï¼šç¯®çƒã€è¶³çƒã€ç¾½æ¯›çƒã€ç½‘çƒã€ä¹’ä¹“çƒ', action: {type: 'exerciseRecord'}};
        }
        
        const exercise = exerciseDB[exerciseName];
        const caloriesBurned = exercise.caloriesPerMin * duration;
        
        // è®°å½•è¿åŠ¨
        const record = {
            id: Date.now(),
            date: new Date().toLocaleDateString(),
            time: new Date().toLocaleTimeString(),
            exercise: exerciseName,
            duration: duration,
            calories: caloriesBurned,
            type: exercise.type
        };
        
        this.exerciseRecords.unshift(record);
        this.saveData();
        
        // è®¡ç®—ä»Šæ—¥æ•°æ®
        const today = new Date().toLocaleDateString();
        const todayMeals = this.mealRecords.filter(r => r.date === today);
        const todayExercises = this.exerciseRecords.filter(r => r.date === today);
        
        const totalIntake = todayMeals.reduce((sum, r) => sum + r.calories, 0);
        const totalBurned = todayExercises.reduce((sum, r) => sum + r.calories, 0);
        const netCalories = totalIntake - totalBurned;
        
        let text = `âœ… è¿åŠ¨è®°å½•æˆåŠŸï¼\n\n`;
        text += `ğŸƒ è¿åŠ¨é¡¹ç›®ï¼š${exerciseName}ï¼ˆ${exercise.type}ï¼‰\n`;
        text += `â±ï¸ è¿åŠ¨æ—¶é•¿ï¼š${duration}åˆ†é’Ÿ\n`;
        text += `ğŸ”¥ æ¶ˆè€—çƒ­é‡ï¼š${caloriesBurned}å¡\n\n`;
        text += `ğŸ“Š ä»Šæ—¥æ•°æ®ï¼š\n`;
        text += `  æ‘„å…¥ï¼š${totalIntake}å¡\n`;
        text += `  æ¶ˆè€—ï¼š${totalBurned}å¡\n`;
        text += `  å‡€æ‘„å…¥ï¼š${netCalories}å¡\n\n`;
        
        // æ™ºèƒ½å»ºè®®
        if (this.userProfile.goal === 'lose' && netCalories > 1500) {
            text += `âš ï¸ å‡€æ‘„å…¥åé«˜ï¼Œå»ºè®®å¢åŠ è¿åŠ¨æˆ–å‡å°‘é¥®é£Ÿ`;
        } else if (this.userProfile.goal === 'gain' && netCalories < 2500) {
            text += `ğŸ’¡ å‡€æ‘„å…¥åä½ï¼Œå»ºè®®å¢åŠ é¥®é£Ÿ`;
        } else if (netCalories < 1200) {
            text += `âš ï¸ çƒ­é‡æ‘„å…¥è¿‡ä½ï¼Œæ³¨æ„è¥å…»å‡è¡¡`;
        } else {
            text += `âœ… çƒ­é‡æ§åˆ¶è‰¯å¥½ï¼Œç»§ç»­ä¿æŒï¼`;
        }
        
        return {text, action: {type: 'exerciseRecord', record, todayData: {totalIntake, totalBurned, netCalories}}};
    }
}